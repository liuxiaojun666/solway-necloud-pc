
ajaxData({
    companyListData:{
        name:'POSTCompanyListData',
        data: {},
        later: true,
    },
    stationListByComid:{
        name:'POSTStationListByComid',
        data: {},
        later: true,
        onlyLatest: true
    },
    deviceTypeList:{
        name:'GETdeviceTypeList',
        data: {},
        later: true,
        onlyLatest: true
    },
    selectDevicesByStation:{
        name:'GETselectDevicesByStation',
        data: {},
        later: true,
        onlyLatest: true
    },
    
    
    
    // updateDeviceOther:{
    //     name:'POSTupdateDeviceOther',
    //     data: {},
    //     later: true,
    //     onlyLatest: true,
    //     saveParam:false
    // },
    
}, {
    __serviceName__: 'editDataInitTplService',
})('editDataInitTplModelCtrl', ['$scope', 'editDataInitTplService', 'actionRecord','$timeout','toaster','$http'], ($scope, myAjaxData, historicalRecord,$timeout,toaster,$http) => {
   
    //公司列表
    const initCompanyList = () => {
        $scope.companyListData.getData({
        }).then(res => {
            console.log(res)
            $scope.companyList = res;
            // $scope.selectedCompanyId = res[0].comId;
            // $scope.initModulesList();
        })
    }

    //电站列表数据
    $scope.getStationList = () =>{
        $scope.stationListByComid.getData({
            companyid: $scope.formData.comId
        }).then(res => {
            $scope.stationList = res;
            // if ($scope.stationList.length){
                
            // }
        })
    }

    //选择完电站
    $scope.changeStation = () =>{
        angular.forEach($scope.stationList,(item,v) => {
            if(item.id == $scope.formData.sid){
                $scope.stationClass = item.stationClass;
            }
        });
        $scope.getDeviceTypeList();
    }

    //设备类型列表
    $scope.getDeviceTypeList = () =>{
        $scope.deviceTypeList.getData({'stationClass':$scope.stationClass}).then(res=>{
            console.log(res)
        });
    }

    //设备列表
    $scope.changeDeviceType = deviceType =>{
        $scope.selectDevicesByStation.getData({
            stid: $scope.pstationid,
            deviceType: deviceType,
        }).then(res=>{
            const selectAllArr = [{deviceType:"",id: '0',name: "",serialNumber: ''}]
            $scope.currentDeviceList = selectAllArr.concat(res);
        });
    }

   
    // 初始
    $scope.$on('editDataInitBroad',async(e,data)=>{
        initCompanyList();
        if(data){
            $scope.formData = {};
            await myAjaxData.timeout(0);
            $scope.$apply();

            $scope.formData = {
                id:data.id,
                serialnumber:data.serialnumber,
                code: data.code,
                name: data.name,
                pstationid: data.pstationid,
                address: data.address,
                devicetype: data.devicetype,
                pname: data.pname,
                pid: data.pid,
                manufid: data.manufid,
                productid: data.productid,
              
            };


            $scope.formData['begindate'] = data.begindate?new Date(data.begindate):new Date();
            $scope.formData['enddate'] = data.enddate?new Date(data.enddate):new Date();
            if(!data.begindate) $scope.formData['begindate'].showDate = '';
            if(!data.enddate) $scope.formData['enddate'].showDate = '';

            await myAjaxData.timeout(0);
            $scope.$apply();
        }else{
            $scope.formData = {};
            await myAjaxData.timeout(0);
            $scope.$apply();
            $scope.formData['begindate'] = new Date();
            $scope.formData['enddate'] = new Date();
            $scope.formData['begindate'].showDate = '';
            $scope.formData['enddate'].showDate = '';
            $scope.formData['pstationid'] = $scope.stationId;

            $scope.formData['devicetype'] = 4;
            $scope.initManufactureData(4);

            await myAjaxData.timeout(0);
            $scope.$apply();
        }

       
    });

    // $scope.showTreeSelect = () =>{
    //     $scope.ifShowTree = $scope.ifShowTree?false:true;
    // }
    //  //保存
    // $scope.saveOther = () =>{
    //     if (!$solway.formValidation($scope.formData, '.editOtherTpl', toaster)) return;//校验非空

    //     $scope.formData['begindate'] = $scope.formData['begindate']?$scope.formData['begindate'].showDate:'' ;
    //     $scope.formData['enddate']   = $scope.formData['enddate']?$scope.formData['enddate'].showDate:'';

    //     $scope.updateDeviceOther.getData($scope.formData).then(res=>{
    //         if(res.type == 'success'){
    //             toaster.pop('success','','保存成功');
    //             $scope.$emit('editOtherCallback');
    //         }else{
    //             toaster.pop('error', '','保存失败')
    //         }
    //     });
    // }

    // //取消
    // $scope.cancelOther = () =>{
    //     $scope.$emit('cancelOther');
    // }
});