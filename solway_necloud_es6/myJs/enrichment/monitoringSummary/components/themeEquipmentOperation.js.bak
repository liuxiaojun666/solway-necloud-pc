ajaxData({}, {
    __serviceName__: 'themeEqumentOperationAjaxData'
})('themeEqumentOperationCtrl', ['$scope', 'themeEqumentOperationAjaxData'], ($scope, myAjaxData) => {

    $scope.initChildScope($scope, myAjaxData);

    const colorArr3 = [{ color: '#e57d70', name: '故障台数' }, { color: '#a99bac', name: '离线台数' }, { color: '#efc185', name: '告警台数' }];
    const colorArr4 = [{ color: '#e57d70', name: '故障台数' }, { color: '#a99bac', name: '离线台数' }, { color: '#efc185', name: '告警台数' }, { color: '#62a6c9', name: '运行台数' }];
    const pieChart = echarts.init(document.getElementById('themeEquipmentPieEchart'))
    const initPieEchart = (dataArr) => {
        window.addEventListener("resize", function () {
            pieChart.resize();
        });
        const option = {
            tooltip: {
                trigger: 'item',
                confine:true,
                // formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            series: [
                {
                    type: 'pie',
                    radius: ['40%', '73%'],
                    center: ['50%', '45%'],
                    label: {
                        normal: {
                            show: false,
                            position: 'inside'
                        },
                        emphasis: {
                            show: false
                        }
                    },
                    lableLine: {
                        normal: {
                            show: false
                        },
                        emphasis: {
                            show: false
                        }
                    },
                    
                    data: dataArr
                }
            ]
        };
        pieChart.setOption(option)
        pieChart.resize();
    }

    const getAjaxData = async () => {

        if ($scope.detailFullPage) return false; //放大状态，不做处理

        await myAjaxData.timeout(0);

        const concatArr = [];
        let arr=[];
        if ($scope.currentClass == 'StationDayToday' || $scope.currentClass == 'CompanyDayToday'){
            arr = colorArr4;
        }else{
            arr = colorArr3;
        }
        for (let i = 0; i <arr.length;i++) {
            concatArr.push({
                value: (Math.random()*10).toFixed(0), name: arr[i].name,
                    itemStyle: {
                    normal: {
                        color: arr[i].color
                    }
                }
            })
        }
        initPieEchart(concatArr);
    }

    

    //父页面初始化完成
    $scope.mainPageInitComplete = () => {
        getAjaxData()
    };

    //切换日期类型
    $scope.dateUpdated = () => {
        getAjaxData()
    }

    //切换电站
    $scope.switchPowerCallback = () => {
        getAjaxData()
    }

    //点击放大后
    $scope.switchDetailFullPage = () => {
        getAjaxData()
    }
});