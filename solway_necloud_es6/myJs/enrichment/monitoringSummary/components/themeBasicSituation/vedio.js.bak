ajaxData({
    selectVideos: {
        name: 'GETPowerStationMonitorSelectVideos',
        data: {},
        onlyLatest: true
    },
}, {
        __serviceName__: 'themeBasicSituationVedioService'
    })('themeBasicSituationVedioCtrl', ['$scope', 'themeBasicSituationVedioService', '$http', , '$ocLazyLoad'], ($scope, myAjaxData, $http, $ocLazyLoad) => {

        $scope.EnableFlash = navigator.plugins['Shockwave Flash'];
        $ocLazyLoad.load([
            "/vendor/videojs/video-js-5.19.2/video-js.min.css",
            "/vendor/videojs/video-js-5.19.2/video.min.js",
        ]).then(() => $ocLazyLoad.load([
            'vendor/videojs/videojs.hotkeys.min.js',   
        ])).then(() => {
            videojs.options.flash.swf = '/vendor/videojs/video-js-5.19.2/video-js-fixed.swf';
            videojs.options.techOrder = ['flash'];
        });


        $scope.selectVideos.subscribe((res) => {
            $scope.params = [];
            const $videosContainer = $('#videosContainer');
            res.videos.forEach((item, i) => {
                $scope.params.push({
                    station_id: item.stId,
                    stream: [
                        {
                            name: item.monitorPointName,
                            source: item.monitorPointSource,
                            dest: item.monitorPointDest
                        }
                    ]
                });

                $videosContainer.append(
                    `<a href="#" title="${item.monitorPointName}" style="
                            position:relative;
                            float:left;
                            display:block;
                            margin-right:2px;
                            margin-bottom:2px;
                            width:${($scope.winWidth - 46) / 3}px;
                            height:${($scope.winWidth - 46) / 4}px" 
                        id="player${i}"></a>`
                );

            });
            timer();
        });

        async function timer() {
            $scope.params.forEach(item => {
                $.ajax({
                    type: 'POST',
                    url: $scope.selectVideos.res.VIDEO_URL,
                    data: JSON.stringify(item), 
                    beforeSend: function (xhr) {}
                });
            });
            if ($scope.isDestroy) return;
            await myAjaxData.timeout(30 * 1000);
            timer();
        }

        $scope.$on('$destroy', () => {
            $scope.isDestroy = true;
        });
    });