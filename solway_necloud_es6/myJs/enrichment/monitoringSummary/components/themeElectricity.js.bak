ajaxData({}, {
    __serviceName__: 'themeElectricityAjaxData'
})('themeElectricityCtrl', ['$scope', 'themeElectricityAjaxData', '$timeout'], ($scope, myAjaxData, $timeout) => {

    $scope.initChildScope($scope, myAjaxData);

    //bar 
    const barChart = echarts.init(document.getElementById('themeEleBarEchart'))
    const initBarEchart = (xAxis, yAxis) => {
        window.addEventListener("resize", function () {
            barChart.resize();
        });
        const option = {
            tooltip: {
                trigger: 'axis',
            },
            grid: {
                top: '55',
                left: '40',
                right: '10',
                bottom: '20',
                // containLabel: true
            },
            xAxis: [
                {
                    // name: '点数',
                    type: 'category',
                    axisLabel: {
                        color: 'white'
                    },
                    axisLine: {
                        lineStyle: {
                            color: 'rgba(154,148,141,0.2)'
                        }
                    },
                    data: xAxis
                }
            ],
            yAxis: [
                {
                    name: '度',
                    nameTextStyle: {
                        color: 'white'
                    },
                    splitLine: {
                        show: false
                    },
                    axisLabel: {
                        color: 'white'
                    },
                    axisLine: {
                        lineStyle: {
                            color: 'rgba(154,148,141,0.2)'
                        }
                    },
                    type: 'value'
                }
            ],
            series: [
                {
                    name: '灰尘影响率',
                    type: 'bar',
                    itemStyle: {
                        normal: {
                            color: '#9364b8'
                        }
                    },
                    label: {
                        normal: {
                            color: 'white'
                        }
                    },
                    barWidth: '10',
                    data: yAxis
                }
            ]
        };
        barChart.setOption(option);
        barChart.resize();
    }

    //pie
    const pieChart = echarts.init(document.getElementById('themeElePieEchart'))
    const pieChartSmall = echarts.init(document.getElementById('themeElePieEchartSmall'))

    const initPieEchart = (pieId) => {
        
        window.addEventListener("resize", function () {
            pieId.resize();
        });
        const option = {
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            series: [
                {
                    name: '半径模式',
                    type: 'pie',
                    radius: ['20%', '80%'],
                    center: ['50%', '40%'],
                    roseType: 'radius',
                    label: {
                        normal: {
                            show: false
                        },
                        emphasis: {
                            show: true
                        }
                    },
                    lableLine: {
                        normal: {
                            show: false
                        },
                        emphasis: {
                            show: true
                        }
                    },
                    data: [
                        {
                            value: 12, name: '限电',
                            itemStyle: {
                                normal: {
                                    color: '#40a5dd'
                                }
                            }
                        },
                        {
                            value: 18, name: '其他',
                            itemStyle: {
                                normal: {
                                    color: '#847ce9'
                                }
                            }
                        },
                        {
                            value: 15, name: '故障',
                            itemStyle: {
                                normal: {
                                    color: '#fa7594'
                                }
                            }
                        }

                    ]
                }
            ]
        };
        pieId.setOption(option);
        pieId.resize();
    }

    const getAjaxData = () => {
        if ($scope.detailFullPage) return false; //放大状态，不做处理

        //左侧柱状图占的比例
        if ($scope.currentClass == 'StationMonth' || $scope.currentClass == 'StationYear' || $scope.currentClass == 'CompanyMonth' || $scope.currentClass == 'CompanyYear'){
            $scope.whichPart = 'part1-3';
        } else if ($scope.currentClass == 'StationDayAgo' || $scope.currentClass == 'CompanyDayAgo'){
            $scope.whichPart = 'part1-2';
        }else{
            $scope.whichPart = 'part1-1';
        }
        
        // $scope.$apply();

        //大小Pie
        if ($scope.whichPart == 'part1-3'){
            initPieEchart(pieChartSmall);
        } else if($scope.whichPart == 'part1-2'){
            initPieEchart(pieChart);
        }

        let x = ['实发电量', '上网电量', '预测发电量', '应发电量'];
        let y = [200, 400, 145, 300]
        initBarEchart(x, y);

    }

    //父页面初始化完成
    $scope.mainPageInitComplete = () => {
       getAjaxData()
    };

    //切换日期类型
    $scope.dateUpdated = () => {
        getAjaxData()
    }

    //切换电站
    $scope.switchPowerCallback = () => {
        getAjaxData()
    }

    //点击放大后
    $scope.switchDetailFullPage = () => {
        getAjaxData()
    }

});