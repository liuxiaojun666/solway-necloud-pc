ajaxData({
    // 电站 日 月 年 
    stationData: {
        name: 'GETpvMonitorGetRunBaseList',
        data: {},
        later: true,
        onlyLatest: true
    },
    // 公司今日
    companyData: {
        name: 'GETBaseSituationCompanyData',
        data: {},
        later: true,
        onlyLatest: true
    },
}, {
        __serviceName__: 'themeBasicSituationDetailService'
    })('themeBasicSituationDetailCtrl', ['$scope', 'themeBasicSituationDetailService', 'historicalRecord'], ($scope, myAjaxData, historicalRecord) => {
        // 初始化 scope
        $scope.initChildScope($scope, myAjaxData);

        // 主页面初始化完成 回调
        $scope.mainPageInitComplete = async () => {
            let { showShape } = historicalRecord.get().themeBasicSituationData || {};
            await $scope.dateUpdated();
            $scope.changeShowShape(showShape || 'list');
            const { dateType, dateTime } = historicalRecord.get();
            $scope.dateType = dateType;
            $scope.dateTime = dateTime;
            $('.ng-clock').removeClass('ng-clock');
            $scope.initComplete = true;
            await myAjaxData.timeout(0);
            diffGetData();
            $scope.$apply();
        };

        // 切换电站 回调
        $scope.switchPowerCallback = () => {
            $scope.stationData.res = null;
            $scope.companyData.res = null;
            diffGetData();
        };

        // 日期改变
        $scope.dateUpdated = async() => {
            await myAjaxData.timeout(0);
            diffData();
            diffGetData();
        };

        // 切换显示形式  图表 or 列表
        $scope.changeShowShape = showShape => {
            if (showShape === $scope.showShape) return;
            $scope.showShape = showShape;
            historicalRecord.set({
                themeBasicSituationData: {
                    ...historicalRecord.get().themeBasicSituationData || {},
                    showShape
                }
            });
            diffData();
        };


        async function diffGetData() {
            if (!$scope.initComplete) return;
            await myAjaxData.timeout(0);
            const { currentClass, showShape, dateTime, dataType, dateType } = $scope;
            // 电站接口
            if (dataType === 0) {
                if ($scope.stationData.res) return;
                $scope.stationData.getData({
                    queryType: 3,
                    dateType: [3, 2, 1][dateType],
                    date: dateTime.showDate
                });
            } else if (dataType > 0) {
                if ($scope.companyData.res) return;
                $scope.companyData.getData({
                    queryType: 1,
                    dateType: [3, 2, 1][dateType],
                    date: dateTime.showDate
                });
            }
        }

        $scope.stationData.getDataCallback = (success, res) => {
            if (!success) return;
            $scope.slideImages = res.body.resultList.scenepictures.split(',').map(v => ({
                url: res.body.resultList.filePath + v
            }));
        };

        // 公司  数据 处理
        $scope.companyData.getDataCallback = (success, res) => {
            if (!success) return;
            $scope.datasource = res.body.resultList;
            $scope.ydatas = [[res.body.resultList.map(v => v.buildcapacity)]];
            $scope.xdata = res.body.resultList.map(v => v.stationname);
            $scope.column = [
                {
                    title: '电站名称',
                    dataIndex: 'stationname',
                    sort: 'true',
                    width: '25%',
                    align: 'left',
                    render(text, item, index) {
                        return `
                            <span>${text}</span>
                            <i class="iconfont icon-zuixin" style="display:none;color:rgb(255, 103, 93);position:absolute;right:1em;top:0;line-height:50px;"></i>`
                    }
                }, {
                    title: '装机容量kW',
                    dataIndex: 'buildcapacity',
                    sort: 'true',
                    width: '10%',
                    align: 'right'
                }, {
                    title: '投产时间',
                    dataIndex: 'productiondate',
                    sort: 'true',
                    width: '10%',
                    align: 'center',
                    render(text) {
                        // const dateStr = new Date(text).Format('yyyy-MM-dd');
                        return `<span>${new Date(text).Format('yyyy-MM-dd')}</span>`
                    }
                }, {
                    title: '接入时间',
                    dataIndex: 'expiryDate',
                    sort: 'true',
                    width: '10%',
                    align: 'center',
                    render(text) {
                        return `<span>${text || ''}</span>`
                    }
                }, {
                    title: '地址',
                    dataIndex: 'address',
                    width: '45%',
                    align: 'left'
                }
            ];
        };

        // 定位
        $scope.showPosition = function () {
            if (!$scope.stationData.res) return;
            if (document.getElementById('allmap').innerHTML === '' && window.themeBasicSituationDataMap === void 0) {
                const map = window.themeBasicSituationDataMap = new BMap.Map('allmap');
                map.enableScrollWheelZoom();   //启用滚轮放大缩小
                map.enableContinuousZoom();    //启用地图惯性拖拽
            }
            const map = window.themeBasicSituationDataMap;
            map.clearOverlays();
            const point = new BMap.Point(parseFloat($scope.stationData.res.body.resultList.longitude) - 0.03083, parseFloat($scope.stationData.res.body.resultList.latitude) + 0.01553);
            map.centerAndZoom(point, 15);
            const point2 = new BMap.Point($scope.stationData.res.body.resultList.longitude, $scope.stationData.res.body.resultList.latitude);
            const marker = new BMap.Marker(point2); // 创建标注
            map.addOverlay(marker); // 将标注添加到地图中
            marker.setAnimation(BMAP_ANIMATION_BOUNCE); //跳动的动画
        };

        // 公司 数据 投产 时间 对比
        async function diffData() {
            if (!$scope.initComplete) return;
            if ($scope.dataType === 0) return;
            if (!$scope.companyData.res) return;
            const {dateType, dateTime} = $scope;
            $scope.imageSymbols = $scope.companyData.res.body.resultList.map(v => {
                const base64str = 'image://data:image/png;base64,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';
                if (dateType === 0 && dateTime.showDate === new Date(v.productiondate).Format('yyyy-MM-dd')) return base64str;
                if (dateType === 1 && dateTime.showDate.substr(0, 7) === new Date(v.productiondate).Format('yyyy-MM')) return base64str;
                if (dateType === 2 && dateTime.showDate.substr(0, 4) === new Date(v.productiondate).Format('yyyy')) return base64str;
            });
            // 列表 图标显示 影藏
            if ($scope.showShape === 'chart') return;
            await myAjaxData.timeout(0);
            const icons = document.querySelectorAll('.iconfont.icon-zuixin');
            $scope.imageSymbols.forEach((v, i) => icons[i].style.display = v ? 'block' : 'none');
        }

    });