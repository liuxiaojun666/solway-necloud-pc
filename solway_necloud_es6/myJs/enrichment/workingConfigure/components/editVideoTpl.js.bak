
ajaxData({
    // personDetail:{
    //     name:'GETpersonDetail',
    //     data: {},
    //     later: true,
    //     onlyLatest: true
    // },
    videoConfigureSave:{
        name:'POSTvideoConfigureSave',
        data: {},
        later: true,
        saveParam:false,
        sameTimeOnce:true
    }
}, {
    __serviceName__: 'addVideoModelService',
})('addVideoModelCtrl', ['$scope', 'addVideoModelService', 'actionRecord','$timeout','toaster','$http'], ($scope, myAjaxData, historicalRecord,$timeout,toaster,$http) => {
    
    // //初始
    $scope.$on('broadAddVideo',function(e,data){
        $scope.id = data.id;
        if($scope.id){
            $scope.formData = data.detail;
        }else{
            $scope.formData = {};
            $scope.formData['ctrl'] = '02';
            $scope.formData['stId'] = $scope.pstationid;
            $scope.formData['destUrl'] = 'rtmp://netest.solway.cn/myapp';
        }
    });

    // //保存
    $scope.saveVideo = () =>{
        if($scope.saveVideoLoading) return;
        if (!$solway.formValidation($scope.formData, '.addVideoModelTpl', toaster)) return;//校验非空
        
        if($scope.formData['ctrl'] == '01'){
            $scope.formData['monitorPointDest'] = null;
            $scope.formData['monitorPointIP'] = null;
            $scope.formData['monitorPointSource'] = null;
        }
        $scope.saveVideoLoading = true;
        $scope.videoConfigureSave.getData($scope.formData).then(res=>{
            $scope.saveVideoLoading = false;

            if(res.key == 0){
                toaster.pop('success','','保存成功');
                $scope.$emit('saveVideoCallback');
            }else{
                toaster.pop('error', '','保存失败')
            }
        });
    }

    //取消
    $scope.cancelVideo = () =>{
        $scope.$emit('cancelCallback');
    }
});