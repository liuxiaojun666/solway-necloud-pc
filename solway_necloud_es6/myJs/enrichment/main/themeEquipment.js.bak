ajaxData(
    {
        stClassLIst: {
            name: 'GETstClassLIst',
            data: {}
        },
        safeRunDayCount: {
            name: 'GETsafeRunDayCount',
            data: {},
            later: true
        },
        completerate: {
            name: 'GETcompleterate',
            data: {},
            later: true
        },
        analysis_company_operation_station_accum_list: {
            name: 'GETanalysis_company_operation_station_accum_list',
            data: {
                queryCode: 'analysis_company_operation_station_accum_list',
                queryType: 1
            },
            later: true
        },
    }, {
        __serviceName__: 'mainEquipmentService',
    }
)('mainEquipmentCtrl', ['$scope', 'mainEquipmentService', 'actionRecord', '$interval'], ($scope, myAjaxData, historicalRecord, $interval) => {
    $('.themeEquipment.ng-clock').removeClass('ng-clock');
    let od, od2;
    // 电站类型列表
    $scope.stClassLIst.subscribe(res => {
        $scope.stClassLIst.res.stClass01 = res.data.some(v => v.id === '01');
        $scope.stClassLIst.res.stClass02 = res.data.some(v => v.id === '02');
    });
    $scope.stClassLIst.subscribe(res => {
        $scope.safeRunDayCount.getData();
        $scope.completerate.getData();
        $scope.analysis_company_operation_station_accum_list.getData({
            queryCode: 'analysis_company_operation_station_accum_list',
            queryType: 1
        });
    });

    $scope.stClassLIst.subscribe(async res => {
        await myAjaxData.timeout(0);
        if ($scope.stClassLIst.res.stClass01) {
            od = new Odometer({ el: document.getElementById('odometer'), value: 100 });
        }
        if ($scope.stClassLIst.res.stClass02) {
            od2 = new Odometer({ el: document.getElementById('odometer2'), value: 100 });
        }
    });

    $scope.safeRunDayCount.subscribe(res => {
        od && od.update('1' + 25);
        od2 && od2.update('1' + '00');
        od2 && $(od2.el).find('.odometer-digit').eq(0).find('.odometer-value').text(1);
    });


    // 运维效率响应处理
    $scope.analysis_company_operation_station_accum_list.subscribe(res => {
        $scope.analysis_company_operation_station_accum_list.res.body.data.maxNum = res.body.data.reduce((a, b) => {
            const newNum = b.res_hours_avg + b.repair_hours_avg;
            return a > newNum ? a : newNum;
        }, 0);
    });

});