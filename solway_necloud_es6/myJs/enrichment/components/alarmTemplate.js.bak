app.directive('alarmTemplate', ['$ocLazyLoad', '$http', '$state', '$timeout','$rootScope', ($ocLazyLoad, $http, $state, $timeout,$rootScope) => ({
    restrict: 'E',
    transclude: !0,
    replace: !0,
    scope: {

    },
    templateUrl: 'tpl/enrichment/components/alarmTemplate.html',
    link($scope, $element) {
        //报警状态
        $scope.currentStatus = 'abnormal'; //abnormal,normal

        if($scope.currentStatus == 'abnormal'){
            $scope.alarmListPageShow = false;
            $scope.ifTwinkle = true;
        }

        //设置列表高度
        const calculateListHeight = () =>{
            $(".alarm-list").height($(window).height()-68);
        }
    
        calculateListHeight();
        window.addEventListener('resize', calculateListHeight);

         //语音
        function speak(textToSpeak) {
            let newUtterance = new SpeechSynthesisUtterance();
            newUtterance.text = textToSpeak;
            window.speechSynthesis.speak(newUtterance);

            document.onkeydown=function(event){ 
                var e = event || window.event || arguments.callee.caller.arguments[0];               
                if (e.keyCode == 65 ) {  
                    window.speechSynthesis.speak(newUtterance);
                }
             };  
        }

        $timeout(()=>{
            speak('中华人民共和国哈哈哈 the People\'s Republic of China;');
        },0)

        //下拉或者收缩
        $scope.toggleAlarmList = () =>{
            $scope.alarmListPageShow = !$scope.alarmListPageShow;
            if ($scope.alarmListPageShow) {
                $scope.ifTwinkle = false;
                $(".alarm-list").slideDown();
            } else {
                $scope.ifTwinkle = true;
                $(".alarm-list").slideUp();
            }
        }

        //批量标记为已确认
        $scope.toConfirm = () =>{
            const checkedIds = [];
            $("input[name='alarmCheckedName']:checked").map((index,v)=>{
                checkedIds.push(v.dataset.ids)
            })
            console.log(checkedIds)

        }
        
        $scope.initData = () =>{
            const checkedCondition = [];
          
            $("input[name='conditionType']:checked").map((index,v)=>{
                checkedCondition.push(v.dataset.status)
            })

            console.log(checkedCondition)

            //测试
            $scope.datalist = [{"stid":3002,"stname":"马鞍山蒙牛1"},{"stid":3003,"stname":"马鞍山蒙牛2"},{"stid":3004,"stname":"马鞍山蒙牛3"}]
            $scope.column = [
                {
                    title: '<label class="i-checks m-b-none"><input type="checkbox"><i style="background:transparent;"></i></label>',
                    dataIndex: '',
                    width: '60px',
                    align: 'center',
                    checkboxName: 'alarmCheckedName',
                    render(text, record, index) {
                        return '<label class="i-checks m-b-none"><input data-ids="' + record.stid + '" name="alarmCheckedName" type="checkbox" /><i style="background:transparent;"></i></label>';
                    }
                },
                {
                    title: '电站名称',
                    dataIndex: 'stname',
                    width: '20%',
                },
                {
                    title: '设备名称',
                    dataIndex: '',
                    width: '20%',
                },
                {
                    title: '故障类型',
                    dataIndex: '',
                },
                {
                    title: '发生时间',
                    dataIndex: '',
                },
                {
                    title: '事件描述',
                    dataIndex: '',
                },
                {
                    title: '确认时间',
                    dataIndex: '',
                },
                {
                    title: '确认',
                    dataIndex: '',
                }
            ];

        }

        $scope.initData();
        

        $scope.$on('$destroy', () => {
            window.removeEventListener('resize', calculateListHeight);
        });
    }
})])
