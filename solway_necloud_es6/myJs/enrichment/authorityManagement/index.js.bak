ajaxData({
    departmentList: {
        name: 'GETdepartmentList',
        data: {},
        later: true
    },
    roleAllList: {
        name: 'GETroleAllList',
        data: {},
        later: true
    }

}, {})('authorityManagementCtrl', ['$scope', 'myAjaxData', 'actionRecord', '$timeout'], ($scope, myAjaxData, historicalRecord, $timeout) => {

    $scope.moduleName = '权限管理';//当前页面名称；

    const getRoleAllList = depid => {
        $scope.tableLoading = true;
        $scope.roleAllList.getData({
            pageIndex: 0,
            pageSize: 10,
            depid: depid,
            roleType: '02'
        }).then(res => {
            $scope.tableLoading = false;
            $scope.column = [
                {
                    title: '角色编码',
                    dataIndex: 'roleCode',
                    align: 'left',
                    sort: true
                }, {
                    title: '角色名称',
                    dataIndex: 'roleName',
                    align: 'center'
                }, {
                    title: '角色描述',
                    dataIndex: 'remark',
                    align: 'center',
                    sort: true
                },
                 {
                    title: '操作',
                    align: 'center',
                    dataIndex:'id',
                    render(text,item,index) {
                        return `
                        <div class="clearfix">
                            <i class="iconfont edit icon-bianji-copy" style="font-size: 18px;color:#1ddabe;margin-right:15px;"></i>
                            <i class="iconfont edit icon-shanchu1" style="font-size: 18px;color:#ff8080;"></i>
                        </div>
                        `
                    },
                }
            ]
        })
    }

    function onClick(event, treeId, treeNode, clickFlag) {
        let depid = treeNode.id;
        getRoleAllList(depid);
    };

    let zTreeObj;
    const setting = {
        check: {
            enable: true,
            chkStyle: "radio",
            radioType: "all"
        },
        data: {
            simpleData: {
                enable: true,
                idKey: "id",
                pIdKey: "pId",
                rootPId: 0
            }
        },
        callback: {
            onClick: onClick
        }
    };

    const initDepartmentList = () => {
        $scope.departmentList.getData({
        }).then(res => {
            if (res.key == 1) {
                const depList = res.data;

                let zNodes = res.data;
                $.fn.zTree.init($("#departmentTree"), setting, zNodes);
                zTreeObj = $.fn.zTree.getZTreeObj("departmentTree")
                $('#departmentTree li:first > a').trigger('click');
                $('#departmentTree li:first > a').trigger('dblclick');
            }
        })
    }

    initDepartmentList();

    $timeout(() => {
        $('.ng-clock').removeClass('ng-clock');
    }, 100);

});