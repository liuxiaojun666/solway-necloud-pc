ajaxData({
    systemModulelist: {
        name: 'GETsystemModulelist',
        data: {},
        later: true,
        onlyLatest: true
    },
    checkCodeExist:{
        name: 'GETcheckCodeExist',
        data: {},
        later: true,
        onlyLatest: true
    },
    selectModule:{
        name: 'GETselectModule',
        data: {},
        later: true,
        onlyLatest: true
    },
    update:{
        name:'POSTupdateModule',
        data: {},
        later: true,
        onlyLatest: true
    }
}, {
    __serviceName__: 'addModuleTplService',
})('addModuleTplCtrl', ['$scope', 'addModuleTplService', 'actionRecord','$timeout','toaster'], ($scope, myAjaxData, historicalRecord,$timeout,toaster) => {

    const initParentModuleData = ()=>{
        $scope.systemModulelist.getData({
            pid:0
        }).then(res=>{
            if(res.code == 0){
                $scope.parrentModuleList = res.body;
            }
        });
    }

    initParentModuleData()

    const save = () =>{
        $scope.formData['id'] = $scope.id;
        $scope.update.getData($scope.formData).then(res=>{
            if(res.code == 0 && res.body.id){
                toaster.pop('success', '','添加成功')
                $scope.$emit('addModuleCallback');
            }
        });
    }

    const selectModuleDetail = id =>{
        $scope.selectModule.getData({
            id:id
        }).then(res=>{
            $scope.formData = res.body;
        });
    }
    $scope.$on('broadAddModule',function(e,data){
        $scope.id = data.moduleId;
        $scope.formData = {};
        if($scope.id){
            selectModuleDetail($scope.id)
        }
        
    });

    //保存
    $scope.save = () =>{
        //校验编码是否存在编码
        $scope.checkCodeExist.getData({
            code:$scope.code
        }).then(res=>{
            if(res.code == 0){
                save();
            }else{
                toaster.pop('error', '',res.msg)
            }
        });
    }

    //取消
    $scope.cancel = () =>{
        $scope.$emit('addModuleCallback');
    }

});