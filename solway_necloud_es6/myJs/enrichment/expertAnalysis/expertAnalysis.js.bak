ajaxData({
    // 分析类型
    HighAnalysis_selectAnlsType: {
        name: 'GETHighAnalysis_selectAnlsType',
        data: {
            stationClass: '01'
        }
    }

}, {
    herizonData: {}, //横轴数据 纵轴数据
    dmsType: null //分析对象参数
})('expertAnalysisCtrl', ['$scope', 'myAjaxData', 'actionRecord', '$interval'], ($scope, myAjaxData, historicalRecord, $interval) => {

    historicalRecord.init();// 历史记录 初始化
    $scope.beforeLoading = true; // 页面loading
    $scope.moduleName = '专家分析';//当前页面名称；
    $scope.endDate = new Date((+new Date) - 1000 * 60 * 60 * 24); // 日历可选 的截止日期
    historyInitCallback();

    // 当前页面行为记录初始化回调 获取行为记录
    async function historyInitCallback() {
        const historiData = historicalRecord.get();
        const {
            startDate = new Date(Date.now() - 1000 * 60 * 60 * 24),
            endDate = new Date(Date.now() - 1000 * 60 * 60 * 24),
        } = historiData;
        $scope.startDate = startDate;
        $scope.endDate = endDate;
        $scope.beforeLoading = false;
        await myAjaxData.timeout(0);
        $scope.$apply();
    };

    // 分析类型下拉框的数据获取
    $scope.HighAnalysis_selectAnlsType.subscribe(res => {
        $scope.selectData = res.body;
    });
    
    var myChart = echarts.getInstanceByDom(document.getElementById("container"));
    // 切换图表排列方式
    $scope.chartSortIndex = 4;
    $scope.chartSort = (index) => {
        $scope.chartSortIndex = index;
        if ($scope.chartSortIndex == 1) {
            $scope.chartStyle = { 'width': '100%', 'height': '100%' }
        } else if ($scope.chartSortIndex == 2) {
            $scope.chartStyle = { 'width': '100%', 'height': '49%' }
        } else if ($scope.chartSortIndex == 3) {
            $scope.chartStyle = { 'width': '49%', 'height': '100%' }
        } else if ($scope.chartSortIndex == 4) {
            $scope.chartStyle = { 'width': '49%' }
        }
    }

    // 图表的点击
    $scope.checkChart = null;
    $scope.checkChartFun = (index) => {
        $scope.checkChart = index;
    }

    //图表函数组
    function chartsOne() {
        var data = [
            [[28604, 77, 17096869, 'Australia', 1990], [31163, 77.4, 27662440, 'Canada', 1990], [1516, 68, 1154605773, 'China', 1990], [13670, 74.7, 10582082, 'Cuba', 1990], [28599, 75, 4986705, 'Finland', 1990], [29476, 77.1, 56943299, 'France', 1990], [31476, 75.4, 78958237, 'Germany', 1990], [28666, 78.1, 254830, 'Iceland', 1990], [1777, 57.7, 870601776, 'India', 1990], [29550, 79.1, 122249285, 'Japan', 1990], [2076, 67.9, 20194354, 'North Korea', 1990], [12087, 72, 42972254, 'South Korea', 1990], [24021, 75.4, 3397534, 'New Zealand', 1990], [43296, 76.8, 4240375, 'Norway', 1990], [10088, 70.8, 38195258, 'Poland', 1990], [19349, 69.6, 147568552, 'Russia', 1990], [10670, 67.3, 53994605, 'Turkey', 1990], [26424, 75.7, 57110117, 'United Kingdom', 1990], [37062, 75.4, 252847810, 'United States', 1990]],
            [[44056, 81.8, 23968973, 'Australia', 2015], [43294, 81.7, 35939927, 'Canada', 2015], [13334, 76.9, 1376048943, 'China', 2015], [21291, 78.5, 11389562, 'Cuba', 2015], [38923, 80.8, 5503457, 'Finland', 2015], [37599, 81.9, 64395345, 'France', 2015], [44053, 81.1, 80688545, 'Germany', 2015], [42182, 82.8, 329425, 'Iceland', 2015], [5903, 66.8, 1311050527, 'India', 2015], [36162, 83.5, 126573481, 'Japan', 2015], [1390, 71.4, 25155317, 'North Korea', 2015], [34644, 80.7, 50293439, 'South Korea', 2015], [34186, 80.6, 4528526, 'New Zealand', 2015], [64304, 81.6, 5210967, 'Norway', 2015], [24787, 77.3, 38611794, 'Poland', 2015], [23038, 73.13, 143456918, 'Russia', 2015], [19360, 76.5, 78665830, 'Turkey', 2015], [38225, 81.4, 64715810, 'United Kingdom', 2015], [53354, 79.1, 321773631, 'United States', 2015]]
        ];
        var dom = document.getElementById("container");
        var myChart = echarts.init(dom);
        var option = null;
        option = {
            xAxis: {
                //改变x轴字体颜色为白色
                axisLabel: {
                    show: true,
                    textStyle: {
                        color: '#fff'
                    }
                },
                //去掉x轴分隔线
                splitLine: {
                    show: false
                },
                //设置轴线的属性
                axisLine: {
                    lineStyle: {
                        color: 'rgba(68, 150, 255, 1)'
                    }
                }

            },
            yAxis: {
                axisLabel: {
                    show: true,
                    textStyle: {
                        color: '#fff'
                    }
                },
                //设置y轴分隔线
                splitLine: {
                    lineStyle: {
                        color: 'rgba(68, 150, 255, 1)'
                    }
                },
                //设置轴线的属性
                axisLine: {
                    show: false
                },
                //去掉刻度线
                axisTick: {
                    show: false
                }
            },
            series: [{
                name: '1990',
                symbolSize: 10,
                data: data[0],
                type: 'scatter',
                label: {
                    emphasis: {
                        show: true,
                        formatter: function (param) {
                            return param.data[3];
                        },
                        position: 'top'
                    }
                },
                itemStyle: {
                    normal: {
                        color: new echarts.graphic.RadialGradient(0.4, 0.3, 1, [{
                            offset: 0,
                            color: 'rgb(251, 118, 123)'
                        }, {
                            offset: 1,
                            color: 'rgb(204, 46, 72)'
                        }])
                    }
                }
            }, {
                name: '2015',
                symbolSize: 10,
                data: data[1],
                type: 'scatter',
                label: {
                    emphasis: {
                        show: true,
                        formatter: function (param) {
                            return param.data[3];
                        },
                        position: 'top'
                    }
                },
                itemStyle: {
                    normal: {
                        color: new echarts.graphic.RadialGradient(0.4, 0.3, 1, [{
                            offset: 0,
                            color: 'rgb(129, 227, 238)'
                        }, {
                            offset: 1,
                            color: 'rgb(25, 183, 207)'
                        }])
                    }
                }
            }],
            grid: {
                top: "15%",
                left: "7%",
                right: "7%",
                bottom: "18%"
            }
        };
        if (option && typeof option === "object") {
            myChart.setOption(option, true);
        }
    }
    chartsOne();

    //resize图表
    var myChart = echarts.getInstanceByDom(document.getElementById("container"));
    $('.table1').resize(function () {
        myChart.resize();
    });


    // 选中第一个下拉框 动态改变其他的下拉框
    $scope.queryData = {

    }
    //点击 弹出框
    $scope.analysisObjectModel = true;
    $scope.horizonIndexChange = (param, id) => {
        if (param == 1) {
            //向纵轴指标发送数据
            $scope.$broadcast('verticalData');
            // 纵轴指标弹出
            if ($scope.queryData.timeLat) {
                $scope.verticalIndexModel = true;
            }
        } else if (param == 2) {
            // 横轴指标弹出
            if ($scope.queryData.timeLat) {
                $scope.horizonIndexModel = true;
            }
        } else if (param == 3) {
            // 统计时间弹出
            $scope.countTimeModel = true;
        } else if (param == 4) {  //时间纬度 数据处理
            if (!$scope.queryData.timeLat) {
                $scope.queryData.horizonIndexV = '请选择';
                $scope.queryData.verticalIndexV = '请选择';
            } else {
                //向横轴指标发送数据
                $scope.$broadcast('dmsTime', $scope.queryData.timeLat);
            }
        } else if (param == 5) {
            // 分析对象弹出
            if ($scope.analysObDataNew) {
                $scope.analysisObjectModel = true;
            }
        } else if (param == 6) {
            // 分析类型下拉框 选中处理数据
            if (!$scope.queryData.analysisType) {
                $scope.analysObDataNew = null;
                $scope.analysObDataNewDevice = null;
                $scope.queryData.analysisObjectV = '请选择';
                $scope.timeLat = null;
                $scope.queryData.timeLat = '';
                $scope.queryData.horizonIndexV = '请选择';
            } else {
                var key;
                for (key in $scope.selectData) {
                    if ($scope.queryData.analysisType == $scope.selectData[key].k) {
                        $scope.analysObDataOld = $scope.selectData[key].ll;
                    }
                }
                $scope.analysObDataNew = $scope.analysObDataOld.filter((item) => {
                    return item.k.substr(0, 1) != "4";
                })
                $scope.analysObDataNewDevice = $scope.analysObDataOld.filter((item) => {
                    return item.k.substr(0, 1) == "4";
                })
            }

            //向分析对象发送数据
            $scope.$broadcast('analysObDataNew', { 'analysObDataNew': $scope.analysObDataNew, 'analysObDataNewDevice': $scope.analysObDataNewDevice });

            //向横轴指标发送anlsType
            $scope.$broadcast('anlsType', $scope.queryData.analysisType);
        } else if (param == 7) {
            // 分析指标弹出
            $scope.analysIndexModel = true;
        }
    }

    //给按钮赋初始值
    $scope.queryData.analysisObjectV = '请选择';
    $scope.queryData.timeLatV = '请选择';
    $scope.queryData.countTimeV = '请选择';
    $scope.queryData.horizonIndexV = '请选择';
    $scope.queryData.verticalIndexV = '请选择';
    $scope.queryData.analysIndexV = '请选择';

    //获取子级发送的数据(被选择的radio)
    $scope.$on('radioToFather', (event, data) => {
        if (data.type == 'horizon') {
            //选择的是横轴指标
            // $scope.horizonRadio = index.radioIndex;
            $scope.queryData.horizonIndexK = data.k;
            $scope.queryData.horizonIndexV = data.value;
        } else if (data.type == 'countTime') {
            // $scope.cTimeRadio = index.radioIndex;
            $scope.queryData.countTimeV = data.name;
        } else if (data.type == 'analysisObject') {
            // $scope.aObjectRadio = index.radioIndex;
            $scope.queryData.analysisObjectK = data.k;
            $scope.queryData.analysisObjectV = data.value;
            // 取时间纬度的数据
            $scope.analysObDataNew.map((item) => {
                if (item.k == $scope.queryData.analysisObjectK) {
                    $scope.timeLat = item.ll;
                }
            })
            //横轴指标获取dmsType
            $scope.$broadcast('dmsType');
        } else if (data.type == 'vertical') {
            //选择的是纵轴指标
            // $scope.verticalRadio = data.radioIndex;
            $scope.queryData.verticalIndexV = data.value;
        } else if (data.type == 'analys') {
            //选择的是分析指标
            $scope.queryData.analysIndexV = data.value;
        }
    })

    // 逆变器 汇流箱 点击 特殊处理 时间纬度的数据
    $scope.$on('deviceTimeLat', (item, v) => {
        $scope.timeLat = v;
    })

    //取消 新增后的回调
    $scope.analysisObjectModel = false;
    $scope.$on('cancelCallback', () => {
        $scope.horizonIndexModel = false;
        $scope.countTimeModel = false;
        $scope.analysisObjectModel = false;
        $scope.verticalIndexModel = false;
    });

    $scope.$on('addCallback', () => {
        $scope.verticalIndexModel = false;
        $scope.countTimeModel = false;
        $scope.analysisObjectModel = false;
        $scope.verticalIndexModel = false;
    });
});

