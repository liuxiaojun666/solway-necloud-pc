ajaxData({
AddbaseDictionary: {
    name: 'AddbaseDictionary',
    data: {},
    later: true
}
}, {
    __serviceName__: 'countTimeService'
})('countTimeCtrl', ['$scope', 'countTimeService', 'actionRecord', '$timeout', 'toaster', 'myAjaxData'], ($scope, _myAjaxData, historicalRecord, $timeout, toaster, parentmyAjaxData) => {

    //保存
    $scope.save = () => {
        if (!$solway.formValidation($scope.formData, '.newStationTpl', toaster)) return;//校验非空

        let formData = {
            id: $scope.id,
            dictType: $scope.formData.dictType,
            dictName: $scope.formData.dictName,
            dictCode: $scope.formData.dictCode,
            dictEnName: $scope.formData.dictEnName,
            description: $scope.formData.description,
            dictValue: $scope.formData.dictValue
        }

        $scope.AddbaseDictionary.getData(formData).then(res => {
            if (res.key == 0) {
                toaster.pop('success', '', '保存成功');
                $scope.$emit('addCallback');
            } else {
                toaster.pop('error', '', '保存失败');
            }
        })
    }

    //获取父级发送的横轴指标 选择的option
    $scope.$on('countTimeNum', (item, index) => {
        $scope.selectIndex = index;
        $scope.radioIndex = index;
    })


    var myDate = new Date();
    var maxYear = myDate.getFullYear();
    var Month = myDate.getMonth() + 1;
    var maxMonth = maxYear + '-' + Month;
    var maxDay = maxMonth + '-' + myDate.getDate();

    // layui日历
    layui.use(['laydate'], function () {
        var laydate = layui.laydate;
        //日
        laydate.render({
            elem: '#cander1', //指定元素
            position: 'static',
            showBottom: false,
            theme: '#245182',
            max: maxDay.toString(),
            done: function (value, date) {
                $scope[key[$scope.radioIndex]].push(value);
                $scope.$apply();
            }
        });
        //月
        laydate.render({
            elem: '#cander2', //指定元素
            position: 'static',
            showBottom: true,
            type: 'month',
            theme: '#245182',
            max: maxMonth.toString(),
            btns: ['confirm'],
            // change: function (value, date, endDate) {
            //     $scope[key[$scope.radioIndex]].push(value);
            //     $scope.$apply();
            // },
            done: function (value, date) {
                $scope[key[$scope.radioIndex]].push(value);
                $scope.$apply();
            }
        });
        //年
        var initYear;
        laydate.render({
            elem: '#cander3', //指定元素
            position: 'static',
            showBottom: true,
            type: 'year',
            theme: '#245182',
            max: maxYear.toString(),
            btns: ['confirm'],
            // ready: function (date) { // 控件在打开时触发，回调返回一个参数：初始的日期时间对象
            //     initYear = date.year;
            // },
            // change: function (value, date, endDate) {
            //     var selectYear = date.year;
            //     var differ = selectYear - initYear;
            //     if (differ == 0) {
            //         $scope[key[$scope.radioIndex]].push(value);
            //         $scope.$apply();
            //     }
            //     initYear = selectYear;
            // },
            done: function (value, date) {
                $scope[key[$scope.radioIndex]].push(value);
                $scope.$apply();
            }
        });

    });


    $scope.radioIndex = 1;
    $scope.selectIndex = 1;
    //单选框选中-> 更改select的值
    $scope.radioToSelect = (name) => {
        var radioIndex = document.querySelectorAll('[name=cTime]'):: [].filter(item => item.checked).map(item => item.dataset.index);
        $scope.$emit('radioToFather', { 'name': name, 'type': 'countTime' });
        $scope.radioIndex = radioIndex[0];
    }

    //独立添加按钮
    $scope.timeGroupDay = [];
    $scope.timeGroupMonth = [];
    $scope.timeGroupYear = [];
    $scope.timeGroupUser = [{
        date: new Date,
        startDate: new Date,
        endDate: new Date
    }];
    // $scope.timeGroupUser = {
    //     date: new Date,
    //     startDate: new Date,
    //     endDate: new Date
    // }
    //监听
    // $scope.$watch('timeGroupUser', (newValue, oldValue) => {
    //     if (newValue.startDate.showDate != oldValue.startDate.showDate&&newValue.endDate.showDate != oldValue.endDate.showDate) {
    //         console.log('change')
    //         console.log(newValue.startDate.showDate)
    //         console.log(oldValue.startDate.showDate)
    //     } else {
    //     }
    // }, true)

    const key = {
        1: 'timeGroupDay',
        2: 'timeGroupMonth',
        3: 'timeGroupYear',
        4: 'timeGroupUser',
    }

    $scope.oneAdd = () => {
        $scope[key[$scope.radioIndex]].push({
            date: new Date,
            startDate: new Date,
            endDate: new Date
        })
        // await myAjaxData.timeout(10)
    }

    //右侧删除小按钮
    $scope.delRight = (id, index) => {
        $scope[key[$scope.radioIndex]].splice(index, 1);
    }

    //全部删除
    $scope.delRightAll = () => {
        if ($scope[key[$scope.radioIndex]].length == 0) {
            toaster.pop('error', '', '请至少选择一条');
        } else {
            $solway.confirm({ message: '确定全部删除吗？' }, () => {
                $scope[key[$scope.radioIndex]] = [];
                $scope.$apply();
            });
        }
    }


    //取消
    $scope.cancel = () => {
        $scope.$emit('cancelCallback');
    }

    //确定
    $scope.confirm = () => {
        $scope.$emit('addCallback');
    }
});