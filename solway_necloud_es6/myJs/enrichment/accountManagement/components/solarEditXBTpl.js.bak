
ajaxData({
    manufacturerList:{
        name:'GETmanufacturerList',
        data: {},
        later: true,
        onlyLatest: true
    },
    selectByManuList:{
        name:'GETselectByManuList',
        data: {},
        later: true,
        onlyLatest: true
    },
    updateDeviceXB:{
        name:'POSTupdateDeviceXB',
        data: {},
        later: true,
        onlyLatest: true
    },
    
}, {
    __serviceName__: 'editXBTplService',
})('editXBTplModelCtrl', ['$scope', 'editXBTplService', 'actionRecord','$timeout','toaster','$http'], ($scope, myAjaxData, historicalRecord,$timeout,toaster,$http) => {
    
    // 初始
    $scope.$on('editXBBroad',function(e,data){
        if(data){
            $scope.formData = data;
            if(data.manufid){
                $scope.changemanufacturer();
            }
            $scope.formData['begindate'] = data.begindate?new Date(data.begindate):new Date();
            $scope.formData['enddate'] = data.enddate?new Date(data.enddate):new Date();
            if(!data.begindate) $scope.formData['begindate'].showDate = '';
            if(!data.enddate) $scope.formData['enddate'].showDate = '';
        }else{
            $scope.formData = {};
            $scope.formData['begindate'] = new Date();
            $scope.formData['enddate'] = new Date();
            $scope.formData['begindate'].showDate = '';
            $scope.formData['enddate'].showDate = '';
        }
    });

    //获取厂商列表
    $scope.getManufacturerList = ()=>{
        $scope.manufacturerList.getData({
        }).then(res=>{
            $scope.manufacturerList = res;
        });
    }
    $scope.getManufacturerList();

    //选择某一厂商，获取产品型号列表
    $scope.changemanufacturer = () =>{
		$scope.selectByManuList.getData({
            manufid : $scope.formData.manufid,
        }).then(res=>{
            console.log(res)

            $scope.productList = res;
        });
    }
    

     //保存
    $scope.saveXB = () =>{
        if (!$solway.formValidation($scope.formData, '.editXBTpl', toaster)) return;//校验非空

        $scope.updateDeviceXB.getData($scope.formData).then(res=>{
            debugger
            if(res.key == 0){
                toaster.pop('success','','保存成功');
                $scope.$emit('saveVideoCallback');
            }else{
                toaster.pop('error', '','保存失败')
            }
        });
    }

    // // //取消
    // $scope.cancelVideo = () =>{
    //     $scope.$emit('cancelCallback');
    // }
});