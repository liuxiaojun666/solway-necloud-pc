
ajaxData({
    stationDeviceNumber:{
        name:'GETstationDeviceNumber',
        data: {},
        later: true,
        onlyLatest: true
    },
    deviceXBList:{
        name:'GETdeviceXBList',
        data: {},
        later: true,
        onlyLatest: true
    }
}, {
    __serviceName__: 'accountSolarTplService',
})('accountSolarTplCtrl', ['$scope', 'accountSolarTplService', 'actionRecord','$timeout','toaster','$http'], ($scope, myAjaxData, historicalRecord,$timeout,toaster,$http) => {
    $scope.menuActive = id =>{
        $scope.activeMenuBtn = id;
        document.getElementById(id).scrollIntoView()
    }

    $scope.menuActive('deviceTypeA');

    $scope.endDate = new Date('2099');

    const initDeviceData = id =>{
        $scope.stationDeviceNumber.getData({id:id}).then(res=>{
            console.log(res)
            $scope.devNumberData = res;
        });
    }

    $scope.$on('solarBroad',(e,data)=>{
        console.log(data)
        $scope.stationId = data.id;
        initDeviceData(data.id);
        $scope.getXBData();
        
    });

    //导出模板---箱变、逆变器、汇流箱
    $scope.exportExcelData = type => {
        const version = $('select[name=version' + type + ']').val();
        let url = "PowerStation/downloadTemplate.htm";
        url +='?stid='+$scope.stationId;
        url += '&version='+version;
        url +='&deviceType='+type;
        window.location.href = url;
    }

    //导入模板---
    $scope.importExcelData = (type,modalId) =>{
        // var version = $('select[name=version_' + type + ']').val();

        // if(!$("#stationid").val()){
        //     alert("未配置电站基本信息");
        // }else{
        //     $("#importExcelDataStid").val($("#stationid").val());
        //     $('#importExcelDataDeviceType').val(type);
        //     $('#'+modalId).modal('show');
        // }
    }

    $scope.columnXB = [
        {
            title: '<label class="i-checks m-b-none"><input type="checkbox"><i style="background:transparent;"></i></label>',
            dataIndex: '',
            width: '60px',
            align: 'center',
            checkboxName: 'videoCheckboxName',
            render(text, record, index) {
                return '<label class="i-checks m-b-none"><input data-id="' + record.id + '" name="videoCheckboxName" type="checkbox" /><i style="background:transparent;"></i></label>';
            }
        },{
            title: '编号',
            dataIndex: 'code',
            sort: !0,
            align: 'center'
        }, {
            title: '设备名称',
            dataIndex: 'name',
            align: 'center',
            sort: !0
        }, {
            title: '产品型号',
            dataIndex: 'productname',
            align: 'center'
        }, {
            title: '位置',
            dataIndex: 'address',
            align: 'center'
        }, {
            title: '操作',
            dataIndex: '',
            align: 'center',
            sort: !0,
            render(text, item, index) {
                return `
                <div class="clearfix">
                    <i class="iconfont edit icon-bianji-copy" style="font-size: 18px;color:#1ddabe;margin-right:15px;"></i>
                    <i class="iconfont edit icon-shanchu1" style="font-size: 18px;color:#ff8080;"></i>
                </div>
                `
            },
        }
    ]

    //获取箱变列表
    $scope.getXBData = () =>{
        $scope.deviceXBList.getData({
            pageIndex:0,
            pageSize:10,
            pstationid:$scope.stationId
        })
    }

    //新增箱变
    $scope.newXB = () =>{
        $scope.editXBModel = true;
        $scope.$broadcast('editXBBroad','');
    }

    //编辑箱变
    $scope.trClickEditXB = (item, index, event) =>{
        $scope.editXBModel = true;
        $scope.$broadcast('editXBBroad',item);
    }
   
});