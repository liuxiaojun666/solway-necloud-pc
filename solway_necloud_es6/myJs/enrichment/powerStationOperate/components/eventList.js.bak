ajaxData({
    // 电站事件列表
    DeviceEventDetail: {
        name: 'GETDeviceEventDetail',
        data: {},
        later: true
    },
    // 删除事件
    deleteDeviceEventDetail: {
        name: 'GETdeleteDeviceEventDetail',
        data: {},
        later: true
    },
}, {
        __serviceName__: 'eventListService'
    })('eventListCtrl', ['$scope', 'eventListService', 'actionRecord', '$timeout', 'toaster', '$interval', 'myAjaxData'], ($scope, _myAjaxData, historicalRecord, $timeout, toaster, $interval, parentmyAjaxData) => {
        // Unix时间戳转换
        function FormatDateTime(UnixTime) {
            var a = UnixTime.replace("/Date(", "").replace(")/", "");
            var date = new Date(parseInt(a));
            var y = date.getFullYear();
            var m = date.getMonth() + 1;
            m = m < 10 ? ('0' + m) : m;
            var d = date.getDate();
            d = d < 10 ? ('0' + d) : d;
            return y + '-' + m + '-' + d;
        };

        const showKey = {
            0: '不显示',
            1: '显示'
        }

        const statusKey = {
            0: '关闭',
            1: '未关闭'
        }

        //获取事件列表
        $scope.$on('eventList', (event, v) => {
            getList();
        })

        var getList = () => {
            $scope.DeviceEventDetail.getData({
                stid: null
            })

            $scope.DeviceEventDetail.subscribe(res => {
                $scope.powerStList = res.body;
                $scope.powerStList.forEach(item => {
                    item.startDateFormat = item.startDate ? FormatDateTime(item.startDate.toString()) : '';
                    item.endDateFormat = item.endDate ? FormatDateTime(item.endDate.toString()) : '';
                    item.showFormat = showKey[item.show];
                    item.statusFormat = statusKey[item.status];
                });
            });
        }

        //删除按钮  编辑按钮
        $scope.delListItem = (item)=>{
            $solway.confirm({ message: '确定删除此事件吗？' }, () => {
                $scope.deleteDeviceEventDetail.getData({
                    id: item.id
                })

                $scope.deleteDeviceEventDetail.subscribe(res => {
                    if (res.code == 0) {
                        toaster.pop('success', '', '删除成功');
                        getList();
                    } else {
                        toaster.pop('error', '', '删除失败');
                    }
                });
            });
        }

        //编辑按钮
        $scope.edit = false;
        $scope.editListItem = (item)=>{
            item.edit = !item.edit;
            $scope.edit = !$scope.edit;
        }

        // $scope.trClick = (item, index, event) => {
        //     if (event.target.className.includes('icon-bianji-copy')) {
        //         $(event.target).parent().parent().siblings('td').find('input').removeClass('disable-input').addClass('able-input').attr('disabled',false);
        //         $('.able-input').parent().parent().css('background','#28527B');
                
        //     } else if (event.target.className.includes('icon-shanchu1')) {
        //         $solway.confirm({ message: '确定删除此事件吗？' }, () => {
        //             $scope.deleteDeviceEventDetail.getData({
        //                 id: item.id
        //             })

        //             $scope.deleteDeviceEventDetail.subscribe(res => {
        //                 if (res.code == 0) {
        //                     toaster.pop('success', '', '删除成功');
        //                     getList();
        //                 } else {
        //                     toaster.pop('error', '', '删除失败');
        //                 }
        //             });
        //         });
        //     }
        // }

        // 返回按钮
        $scope.back = () => {
            $scope.$emit('eventListHide');
        }

        //表格的表头设置
        $scope.column = [
            {
                title: '事件标题',
                dataIndex: 'title',
                align: 'left'
            }, {
                title: '事件详情',
                width: '25%',
                dataIndex: 'detail',
                align: 'left',
                render(text,item,index) {
                    return `<div style="position:relative;">
                        <input value="${text?text:''}" class="disable-input" disabled="disabled">
                    </div>`
                },
            }, {
                title: '开始时间',
                dataIndex: 'startDateFormat',
                align: 'center',
                sort: !0,
                render(text,item,index) {
                    return `<calendar style="display: inline-block;" calendar-type="yyyy-MM-dd HH:mm"
                    show-arrow="false" clearable="false" date-time="text"></calendar>`
                },
            }, {
                title: '结束时间',
                dataIndex: 'endDateFormat',
                align: 'center',
                sort: !0
            }, {
                title: '前端显示',
                dataIndex: 'showFormat',
                align: 'center'
            }, {
                title: '事件状态',
                dataIndex: 'statusFormat',
                align: 'center'
            },
            {
                title: '操作',
                dataIndex: '',
                align: 'center',
                sort: !0,
                render: function () {
                    function render(text, item, index) {
                        return `<div class="clearfix"><i class="iconfont icon-bianji-copy" style="font-size: 18px;color:#1ddabe;margin-right:15px;" title="编辑"></i><i class="iconfont icon-shanchu1" style="font-size: 18px;color:#ff8080;" title="删除"></i></div>`;
                    }
                    return render;
                }()
            }];
    });