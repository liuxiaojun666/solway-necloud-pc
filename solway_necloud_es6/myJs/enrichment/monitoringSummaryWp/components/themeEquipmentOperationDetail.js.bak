ajaxData({
    //集团-今日
    companyToday: {
        name: 'GETequipmentDetailCompanyToday',
        data: {},
        later: true,
        onlyLatest: true
    },
    //集团-历史日-列表
    query_company_day_dev_detail_stationlist_his: {
        name: 'GETquery_company_day_dev_detail_stationlist_his',
        data: {},
        later: true,
        onlyLatest: true
    },
    //集团-历史日-曲线
    query_company_day_dev_detail_stationline_his: {
        name: 'GETquery_company_day_dev_detail_stationline_his',
        data: {},
        later: true,
        onlyLatest: true
    },
    //集团-月-时间列表
    query_company_month_dev_detail_timelist_his: {
        name: 'GETquery_company_month_dev_detail_timelist_his',
        data: {},
        later: true,
        onlyLatest: true
    },
    //集团-月-时间曲线
    query_company_month_dev_detail_timeline_his: {
        name: 'GETquery_company_month_dev_detail_timeline_his',
        data: {},
        later: true,
        onlyLatest: true
    },
    //集团-月-电站列表
    query_company_month_dev_detail_stationlist_his: {
        name: 'GETquery_company_month_dev_detail_stationlist_his',
        data: {},
        later: true,
        onlyLatest: true
    },
    //集团-月-电站曲线
    query_company_month_dev_detail_stationline_his: {
        name: 'GETquery_company_month_dev_detail_stationline_his',
        data: {},
        later: true,
        onlyLatest: true
    },
    //集团-年-时间列表
    query_company_year_dev_detail_timelist_his: {
        name: 'GETquery_company_year_dev_detail_timelist_his',
        data: {},
        later: true,
        onlyLatest: true
    },
    //集团-年-时间曲线
    query_company_year_dev_detail_timeline_his: {
        name: 'GETquery_company_year_dev_detail_timeline_his',
        data: {},
        later: true,
        onlyLatest: true
    },
    //集团-年-电站列表
    query_company_year_dev_detail_stationlist_his: {
        name: 'GETquery_company_year_dev_detail_stationlist_his',
        data: {},
        later: true,
        onlyLatest: true
    },
    //集团-年-电站曲线
    query_company_year_dev_detail_stationline_his: {
        name: 'GETquery_company_year_dev_detail_stationline_his',
        data: {},
        later: true,
        onlyLatest: true
    },

    //电站-今日-故障分析
    faultAlarmTotalStatistics: {
        name: 'GETfaultAlarmTotalStatistics',
        data: {},
        later: true,
        onlyLatest: true,
        sameTimeOnce: true,
    },
    //电站-今日-故障列表
    getStationFaultAlarmRtData: {
        name: 'GETgetStationFaultAlarmRtData',
        data: {},
        later: true,
        onlyLatest: true,
        sameTimeOnce: true,
    },
    // 电站 今日 发电能力
    query_station_day_dev_power_timelist_his: {
        name: 'GETquery_station_day_dev_power_timelist_his',
        data: {},
        later: true,
        onlyLatest: true,
    },
    //电站-月-时间列表
    query_station_month_dev_detail_timelist_his: {
        name: 'GETquery_station_month_dev_detail_timelist_his',
        data: {},
        later: true,
        onlyLatest: true
    },
    //电站-月-时间曲线
    query_station_month_dev_detail_timeline_his: {
        name: 'GETquery_station_month_dev_detail_timeline_his',
        data: {},
        later: true,
        onlyLatest: true
    },
    //电站-月-设备列表
    query_station_month_dev_detail_devlist_his: {
        name: 'GETquery_station_month_dev_detail_devlist_his',
        data: {},
        later: true,
        onlyLatest: true
    },
    //电站-月-设备曲线
    query_station_month_dev_detail_devline_his: {
        name: 'GETquery_station_month_dev_detail_devline_his',
        data: {},
        later: true,
        onlyLatest: true
    },
    //电站-年-时间列表
    query_station_year_dev_detail_timelist_his: {
        name: 'GETquery_station_year_dev_detail_timelist_his',
        data: {},
        later: true,
        onlyLatest: true
    },
    //电站-年-时间曲线
    query_station_year_dev_detail_timeline_his: {
        name: 'GETquery_station_year_dev_detail_timeline_his',
        data: {},
        later: true,
        onlyLatest: true
    },
    //电站-年-设备列表
    query_station_year_dev_detail_devlist_his: {
        name: 'GETquery_station_year_dev_detail_devlist_his',
        data: {},
        later: true,
        onlyLatest: true
    },
    //电站-年-设备曲线
    query_station_year_dev_detail_devline_his: {
        name: 'GETquery_station_year_dev_detail_devline_his',
        data: {},
        later: true,
        onlyLatest: true
    }
}, {
        __serviceName__: 'themeEquipmentOperationService'
    })('themeEquipmentOperationDetailCtrl', ['$scope', 'themeEquipmentOperationService', 'actionRecord', '$interval'], ($scope, myAjaxData, historicalRecord, $interval) => {
        // 初始化 scope
        $scope.initChildScope($scope, myAjaxData);

        // 主页面初始化完成 回调
        $scope.mainPageInitComplete = async () => {
            let { showShape, select1, select2, tabIndex = 0 } = historicalRecord.get().themeEquipmentOperation || {};
            $scope.changeShowShape(showShape || 'list');
            const { dateType, dateTime } = historicalRecord.get();
            $scope.dateType = dateType;
            $scope.dateTime = dateTime;
            await $scope.dateUpdated();
            $scope.select1 = select1;
            $scope.select2 = select2;
            if (select1) await $scope.selectChange('select1');
            if (select2) await $scope.selectChange('select2');
            $scope.changeTab(tabIndex);
            $('.ng-clock').removeClass('ng-clock');

            $scope.initComplete = true;
            await myAjaxData.timeout(0);

            $scope.equipmentDetailLoading = true;
            diffGetData();
            $scope.$apply();
        };

        // 切换显示形式  图表 or 列表
        $scope.changeShowShape = showShape => {
            if (showShape === $scope.showShape) return;
            $scope.showShape = showShape;
            historicalRecord.set({
                themeEquipmentOperation: {
                    ...historicalRecord.get().themeEquipmentOperation || {},
                    showShape
                }
            });
            $scope.equipmentDetailLoading = true;
            diffGetData();
        };
        // tab 切换
        $scope.changeTab = tabIndex => {
            if (tabIndex === $scope.tabIndex) return;
            $scope.tabIndex = tabIndex;
            historicalRecord.set({
                themeEquipmentOperation: {
                    ...historicalRecord.get().themeEquipmentOperation || {},
                    tabIndex
                }
            });
            $scope.column = [];
            $scope.equipmentDetailLoading = true;
            diffGetData();
        };
        // 图标轴线切换
        $scope.selectChange = async (arg) => {
            await myAjaxData.timeout(0);
            historicalRecord.set({
                themeEquipmentOperation: {
                    ...historicalRecord.get().themeEquipmentOperation || {},
                    [arg]: $scope[arg]
                }
            });
            diffChartLineData();
            $scope.$apply();
        };

        // 切换电站 回调
        $scope.switchPowerCallback = () => {
            $scope.equipmentDetailLoading = true;
            diffGetData();
        };

        // 日期改变
        $scope.dateUpdated = () => {
            $scope.equipmentDetailLoading = true;
            diffGetData();
        };

        // 详情 放大缩小  回调
        $scope.switchDetailFullPage = () => {
        }

        // 判断 调用  对应 接口
        async function diffGetData() {
            if (!$scope.initComplete) return;
            await myAjaxData.timeout(0);
            if ($scope.currentClass != 'CompanyDayToday' && $scope.currentClass != 'StationDayToday') {
                $scope.column = [];
                $scope.xdata = void 0;
                $scope.ydatas = void 0;
            }
            const { currentClass, showShape, dateTime, tabIndex, dateType } = $scope;
            switch (currentClass) {
                case 'CompanyDayToday':   //集团当日
                    $scope.companyToday.getData({
                        queryType: 1,
                        dateType: 3,
                        date: dateTime.showDate
                    });
                    break;
                case 'CompanyDayAgo':     //集团历史日
                    if (showShape === 'list') {
                        $scope.query_company_day_dev_detail_stationlist_his.res = null;
                        $scope.query_company_day_dev_detail_stationlist_his.getData({
                            queryCode: 'query_company_day_dev_detail_stationlist_his',
                            queryType: 1,
                            date: dateTime.showDate
                        });
                    } else {
                        $scope.query_company_day_dev_detail_stationline_his.res = null;
                        $scope.query_company_day_dev_detail_stationline_his.getData({
                            queryCode: 'query_company_day_dev_detail_stationline_his',
                            queryType: 1,
                            date: dateTime.showDate
                        });
                    }
                    break;
                case 'CompanyMonth':   //集团月
                    if (showShape === 'list' && tabIndex === 0) {//时间
                        $scope.query_company_month_dev_detail_timelist_his.getData({
                            queryCode: 'query_company_month_dev_detail_timelist_his',
                            queryType: 1,
                            date: dateTime.showDate
                        });
                    } else if (showShape === 'chart' && tabIndex === 0) {
                        $scope.query_company_month_dev_detail_timeline_his.getData({
                            queryCode: 'query_company_month_dev_detail_timeline_his',
                            queryType: 1,
                            date: dateTime.showDate
                        });
                    } else if (showShape === 'list' && tabIndex === 1) {//电站
                        $scope.query_company_month_dev_detail_stationlist_his.getData({
                            queryCode: 'query_company_month_dev_detail_stationlist_his',
                            queryType: 1,
                            date: dateTime.showDate
                        });
                    } else if (showShape === 'chart' && tabIndex === 1) {
                        $scope.query_company_month_dev_detail_stationline_his.getData({
                            queryCode: 'query_company_month_dev_detail_stationline_his',
                            queryType: 1,
                            date: dateTime.showDate
                        });
                    }
                    break;
                case 'CompanyYear':   //集团年
                    if (showShape === 'list' && tabIndex === 0) {//时间
                        $scope.query_company_year_dev_detail_timelist_his.getData({
                            queryCode: 'query_company_year_dev_detail_timelist_his',
                            queryType: 1,
                            date: dateTime.showDate
                        });
                    } else if (showShape === 'chart' && tabIndex === 0) {
                        $scope.query_company_year_dev_detail_timeline_his.getData({
                            queryCode: 'query_company_year_dev_detail_timeline_his',
                            queryType: 1,
                            date: dateTime.showDate
                        });
                    } else if (showShape === 'list' && tabIndex === 1) {//电站
                        $scope.query_company_year_dev_detail_stationlist_his.getData({
                            queryCode: 'query_company_year_dev_detail_stationlist_his',
                            queryType: 1,
                            date: dateTime.showDate
                        });
                    } else if (showShape === 'chart' && tabIndex === 1) {
                        $scope.query_company_year_dev_detail_stationline_his.getData({
                            queryCode: 'query_company_year_dev_detail_stationline_his',
                            queryType: 1,
                            date: dateTime.showDate
                        });
                    }
                    break;
                case 'StationDayToday':
                    if (tabIndex === 0) {
                        $scope.faultAlarmTotalStatistics.getData({});
                        $scope.getStationFaultAlarmRtData.getData({
                            pageIndex: 0,
                            pageSize: 10
                        });
                    } else if (tabIndex === 1) {
                        // if ($scope.query_station_day_dev_power_timelist_his.res) return;
                        $scope.query_station_day_dev_power_timelist_his.getData({
                            queryCode: 'query_station_day_dev_power_timelist_his',
                            queryType: 3,
                            pgc: 0,
                            date: dateTime.showDate
                        });
                    }
                    break;
                case 'StationDayAgo'://电站历史日
                    if (tabIndex === 1) {
                        $scope.query_station_day_dev_power_timelist_his.getData({
                            queryCode: 'query_station_day_dev_power_timelist_his',
                            queryType: 3,
                            pgc: 0,
                            date: dateTime.showDate
                        });
                    }
                    break;
                case 'StationMonth': //电站月
                    if (showShape === 'list' && tabIndex === 0) {//时间
                        $scope.query_station_month_dev_detail_timelist_his.getData({
                            queryCode: 'query_station_month_dev_detail_timelist_his',
                            queryType: 3,
                            date: dateTime.showDate
                        });
                    } else if (showShape === 'chart' && tabIndex === 0) {
                        $scope.query_station_month_dev_detail_timeline_his.getData({
                            queryCode: 'query_station_month_dev_detail_timeline_his',
                            queryType: 3,
                            date: dateTime.showDate
                        });
                    } else if (showShape === 'list' && tabIndex === 1) {//设备
                        $scope.query_station_month_dev_detail_devlist_his.getData({
                            queryCode: 'query_station_month_dev_detail_devlist_his',
                            queryType: 3,
                            date: dateTime.showDate
                        });
                    } else if (showShape === 'chart' && tabIndex === 1) {
                        $scope.query_station_month_dev_detail_devline_his.getData({
                            queryCode: 'query_station_month_dev_detail_devline_his',
                            queryType: 3,
                            date: dateTime.showDate
                        });
                    }
                    break;
                case 'StationYear': //电站年
                    if (showShape === 'list' && tabIndex === 0) {//时间
                        $scope.query_station_year_dev_detail_timelist_his.getData({
                            queryCode: 'query_station_year_dev_detail_timelist_his',
                            queryType: 3,
                            date: dateTime.showDate
                        });
                    } else if (showShape === 'chart' && tabIndex === 0) {
                        $scope.query_station_year_dev_detail_timeline_his.getData({
                            queryCode: 'query_station_year_dev_detail_timeline_his',
                            queryType: 3,
                            date: dateTime.showDate
                        });
                    } else if (showShape === 'list' && tabIndex === 1) {//设备
                        $scope.query_station_year_dev_detail_devlist_his.getData({
                            queryCode: 'query_station_year_dev_detail_devlist_his',
                            queryType: 3,
                            date: dateTime.showDate
                        });
                    } else if (showShape === 'chart' && tabIndex === 1) {
                        $scope.query_station_year_dev_detail_devline_his.getData({
                            queryCode: 'query_station_year_dev_detail_devline_his',
                            queryType: 3,
                            date: dateTime.showDate
                        });
                    }
                    break;
                default:
                    break;
            }
        }

        //集团当日
        $scope.companyToday.getDataCallback = (success, res) => {
            $scope.equipmentDetailLoading = false;
            if (!success) return;
            $scope.column = [
                {
                    title: '电站名称',
                    width: '25%',
                    dataIndex: 'st_name',
                    align: 'left',
                },
                {
                    title: '总台数',
                    dataIndex: '',
                    sort: 'true',
                    align: 'right',
                    render(text, item, index) {
                        return `<span>${item.comm + item.fault + item.maintain + item.run + item.wait || ''}</span>`
                    }
                },
                {
                    title: '运行台数',
                    dataIndex: 'run',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: '待机',
                    dataIndex: 'wait',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: '故障',
                    dataIndex: 'fault',
                    sort: 'true',
                    align: 'right'
                },
                {
                    title: '维护',
                    dataIndex: 'maintain',
                    sort: 'true',
                    align: 'right'
                },
                {
                    title: '离线',
                    dataIndex: 'comm',
                    sort: 'true',
                    align: 'right'
                }
            ];
        };

        //集团历史日-列表
        $scope.query_company_day_dev_detail_stationlist_his.getDataCallback = (success, res) => {
            $scope.equipmentDetailLoading = false;
            if (!success) return;
            $scope.column = [
                {
                    title: '电站名称',
                    width: '25%',
                    dataIndex: 'st_name',
                    align: 'left',
                },
                {
                    title: '总台数',
                    dataIndex: 'eqcount',
                    sort: 'true',
                    align: 'right'
                },
                {
                    title: '故障台次',
                    dataIndex: 'fail_count',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: '维护台次',
                    dataIndex: 'alarm_count',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: '离线台次',
                    dataIndex: 'inter_count',
                    sort: 'true',
                    align: 'right'
                },
                {
                    title: '故障损失电量(' + res.body.units.fail_we + ')',
                    width: '150px',
                    dataIndex: 'fail_we',
                    sort: 'true',
                    align: 'right'
                },
                {
                    title: 'mttr',
                    width: '60px',
                    dataIndex: 'run',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: 'mtbf',
                    width: '60px',
                    dataIndex: 'mtbf',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: 'pba',
                    width: '60px',
                    dataIndex: 'pba',
                    sort: 'true',
                    align: 'right'
                },
                {
                    title: 'pr',
                    width: '60px',
                    dataIndex: 'pr',
                    sort: 'true',
                    align: 'right'
                }
            ];
        };

        //集团历史日-曲线
        $scope.query_company_day_dev_detail_stationline_his.getDataCallback = (success, res) => {
            $scope.equipmentDetailLoading = false;
            if (!success) return;
            diffSelectOptions(res.body.units);//图表设置selectOptions  
            $scope.select1 = $scope.selectOptions[$scope.select1 || '__'] ? $scope.select1 : 'fail_we';
            $scope.select2 = $scope.selectOptions[$scope.select2 || '__'] ? $scope.select2 : 'fail_count';
            $scope.xdata = res.body.data.st_name;
            $scope.ydatas = [[res.body.data[$scope.select1]], [res.body.data[$scope.select2]]];
        }

        //集团月-时间-列表
        $scope.query_company_month_dev_detail_timelist_his.getDataCallback = (success, res) => {
            $scope.equipmentDetailLoading = false;
            if (!success) return;
            $scope.dataSource = res.body.data;
            $scope.column = [
                {
                    title: '时间',
                    dataIndex: 'dtime',
                    align: 'center',
                },
                {
                    title: '故障台次',
                    dataIndex: 'fail_count',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: '维护台次',
                    dataIndex: 'alarm_count',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: '离线台次',
                    dataIndex: 'inter_count',
                    sort: 'true',
                    align: 'right'
                }
            ];
        };

        //集团月-时间-曲线
        $scope.query_company_month_dev_detail_timeline_his.getDataCallback = (success, res) => {
            $scope.equipmentDetailLoading = false;
            if (!success) return;
            diffSelectOptions(res.body.units);
            $scope.select1 = $scope.selectOptions[$scope.select1 || '__'] ? $scope.select1 : 'fail_count';
            $scope.xdata = res.body.data.dtime;
            $scope.ydatas = [[res.body.data[$scope.select1]]];
        }

        //集团月-电站-列表
        $scope.query_company_month_dev_detail_stationlist_his.getDataCallback = (success, res) => {
            $scope.equipmentDetailLoading = false;
            if (!success) return;
            $scope.dataSource = res.body.data;
            $scope.column = [
                {
                    title: '电站名称',
                    width: '25%',
                    dataIndex: 'st_name',
                    align: 'left',
                },
                {
                    title: '总台数',
                    dataIndex: 'eqcount',
                    sort: 'true',
                    align: 'right'
                },
                {
                    title: '故障台次',
                    dataIndex: 'fail_count',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: '维护台次',
                    dataIndex: 'alarm_count',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: '离线台次',
                    dataIndex: 'inter_count',
                    sort: 'true',
                    align: 'right'
                },
                {
                    title: '故障损失电量(' + res.body.units.fail_we + ')',
                    dataIndex: 'fail_we',
                    sort: 'true',
                    align: 'right'
                },
                {
                    title: 'mttr',
                    dataIndex: 'run',
                    width: '60px',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: 'mtbf',
                    width: '60px',
                    dataIndex: 'mtbf',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: 'pba',
                    width: '60px',
                    dataIndex: 'pba',
                    sort: 'true',
                    align: 'right'
                },
                {
                    title: 'pr',
                    width: '60px',
                    dataIndex: 'pr',
                    sort: 'true',
                    align: 'right'
                }
            ];
        };

        //集团月-电站-曲线
        $scope.query_company_month_dev_detail_stationline_his.getDataCallback = (success, res) => {
            $scope.equipmentDetailLoading = false;
            if (!success) return;
            diffSelectOptions(res.body.units);
            $scope.select1 = $scope.selectOptions[$scope.select1 || '__'] ? $scope.select1 : 'fail_we';
            $scope.select2 = $scope.selectOptions[$scope.select2 || '__'] ? $scope.select2 : 'fail_count';
            $scope.xdata = res.body.data.st_name;
            $scope.ydatas = [[res.body.data[$scope.select1]], [res.body.data[$scope.select2]]];
        }

        //集团年-时间-列表
        $scope.query_company_year_dev_detail_timelist_his.getDataCallback = (success, res) => {
            $scope.equipmentDetailLoading = false;
            if (!success) return;
            $scope.dataSource = res.body.data;
            $scope.column = [
                {
                    title: '时间',
                    dataIndex: 'dtime',
                    align: 'center',
                },
                {
                    title: '故障台次',
                    dataIndex: 'fail_count',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: '维护台次',
                    dataIndex: 'alarm_count',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: '离线台次',
                    dataIndex: 'inter_count',
                    sort: 'true',
                    align: 'right'
                }
            ];
        };

        //集团年-时间-曲线
        $scope.query_company_year_dev_detail_timeline_his.getDataCallback = (success, res) => {
            $scope.equipmentDetailLoading = false;
            if (!success) return;
            diffSelectOptions(res.body.units);
            $scope.select1 = $scope.selectOptions[$scope.select1 || '__'] ? $scope.select1 : 'fail_count';
            $scope.xdata = res.body.data.dtime;
            $scope.ydatas = [[res.body.data[$scope.select1]]];
        }

        //集团年-电站-列表
        $scope.query_company_year_dev_detail_stationlist_his.getDataCallback = (success, res) => {
            $scope.equipmentDetailLoading = false;
            if (!success) return;
            $scope.dataSource = res.body.data;
            $scope.column = [
                {
                    title: '电站名称',
                    width: '25%',
                    dataIndex: 'st_name',
                    align: 'left',
                },
                {
                    title: '总台数',
                    dataIndex: 'eqcount',
                    sort: 'true',
                    align: 'right'
                },
                {
                    title: '故障台次',
                    dataIndex: 'fail_count',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: '维护台次',
                    dataIndex: 'alarm_count',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: '离线台次',
                    dataIndex: 'inter_count',
                    sort: 'true',
                    align: 'right'
                },
                {
                    title: '故障损失电量(' + res.body.units.fail_we + ')',
                    dataIndex: 'fail_we',
                    sort: 'true',
                    align: 'right'
                },
                {
                    title: 'mttr',
                    width: '60px',
                    dataIndex: 'run',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: 'mtbf',
                    width: '60px',
                    dataIndex: 'mtbf',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: 'pba',
                    width: '60px',
                    dataIndex: 'pba',
                    sort: 'true',
                    align: 'right'
                },
                {
                    title: 'pr',
                    width: '60px',
                    dataIndex: 'pr',
                    sort: 'true',
                    align: 'right'
                }
            ];
        };

        //集团年-电站-曲线
        $scope.query_company_year_dev_detail_stationline_his.getDataCallback = (success, res) => {
            $scope.equipmentDetailLoading = false;
            if (!success) return;
            diffSelectOptions(res.body.units);
            $scope.select1 = $scope.selectOptions[$scope.select1 || '__'] ? $scope.select1 : 'fail_we';
            $scope.select2 = $scope.selectOptions[$scope.select2 || '__'] ? $scope.select2 : 'fail_count';
            $scope.xdata = res.body.data.st_name;
            $scope.ydatas = [[res.body.data[$scope.select1]], [res.body.data[$scope.select2]]];
        }

        //电站-故障分析
        $scope.faultAlarmTotalStatistics.getDataCallback = (success, res) => {
            if (!success) return;
            $scope.faultData = res;
        }

        //电站-故障列表
        $scope.getStationFaultAlarmRtData.getDataCallback = (success, res) => {
            $scope.equipmentDetailLoading = false;
            if (!success) return;
            $scope.column = [
                {
                    title: '设备名称',
                    width: '25%',
                    dataIndex: 'name',
                    sort: 'true',
                    align: 'left',
                },
                {
                    title: '故障类型',
                    dataIndex: 'eventType',
                    sort: 'true',
                    align: 'center'
                },
                {
                    title: '设备类型',
                    dataIndex: 'deviceType',
                    sort: 'true',
                    align: 'center'
                },
                {
                    title: '故障发生时间',
                    dataIndex: 'sStartTime',
                    sort: 'true',
                    align: 'center'
                },
                {
                    title: '故障描述',
                    dataIndex: 'eventDesc',
                    sort: 'true',
                    align: 'center'
                },
                {
                    title: '持续时间',
                    dataIndex: 'hours',
                    sort: 'true',
                    align: 'center'
                },
                // {
                //     title: '处理详情',
                //     dataIndex: '',
                //     sort: 'true',
                //     align: 'right',
                //     render(text, item, index) {
                //         return `<span>待写</span>`
                //     }
                // }
            ];
        }

        // 电站 今日 发电能力
        $scope.query_station_day_dev_power_timelist_his.getDataCallback = (success, res) => {
            $scope.equipmentDetailLoading = false;
            if (!success)return;
            $scope.xdata = res.body.data.map(v => v.dtime);
            $scope.ydatas = [[res.body.data.map(v => v.pgc)], [res.body.data.map(v => v.pcpn)]];
        };


        //电站月-时间-列表
        $scope.query_station_month_dev_detail_timelist_his.getDataCallback = (success, res) => {
            $scope.equipmentDetailLoading = false;
            if (!success) return;
            $scope.dataSource = res.body.data;
            $scope.column = [
                {
                    title: '时间',
                    dataIndex: 'dtime',
                    align: 'center',
                },
                {
                    title: '故障台次',
                    dataIndex: 'fail_count',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: '告警台次',
                    dataIndex: 'alarm_count',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: '离线台次',
                    dataIndex: 'inter_count',
                    sort: 'true',
                    align: 'right'
                },
                {
                    title: '故障损失电量(' + res.body.units.dust_we + ')',
                    dataIndex: 'dust_we',
                    sort: 'true',
                    align: 'right'
                },
                {
                    title: 'mttr',
                    width: '60px',
                    dataIndex: 'mttr',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: 'mtbf',
                    width: '60px',
                    dataIndex: 'mtbf',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: 'pba',
                    width: '60px',
                    dataIndex: 'pba',
                    sort: 'true',
                    align: 'right'
                },
                {
                    title: 'pr',
                    width: '60px',
                    dataIndex: 'pr',
                    sort: 'true',
                    align: 'right'
                }
            ];
        };

        //电站月-时间-曲线
        $scope.query_station_month_dev_detail_timeline_his.getDataCallback = (success, res) => {
            $scope.equipmentDetailLoading = false;
            if (!success) return;
            diffSelectOptions(res.body.units);
            $scope.select1 = $scope.selectOptions[$scope.select1 || '__'] ? $scope.select1 : 'dust_we';
            $scope.select2 = $scope.selectOptions[$scope.select2 || '__'] ? $scope.select2 : 'fail_count';
            $scope.xdata = res.body.data.dtime;
            $scope.ydatas = [[res.body.data[$scope.select1]], [res.body.data[$scope.select2]]];
        }

        //电站月-设备-列表
        $scope.query_station_month_dev_detail_devlist_his.getDataCallback = (success, res) => {
            $scope.equipmentDetailLoading = false;
            if (!success) return;
            $scope.dataSource = res.body.data;
            $scope.column = [
                {
                    title: '设备名称',
                    width: '25%',
                    dataIndex: 'eq_name',
                    align: 'left',
                },
                // {
                //     title: '总台数',
                //     dataIndex: 'eqcount',
                //     sort: 'true',
                //     align: 'right'
                // },
                {
                    title: '故障台次',
                    dataIndex: 'fail_count',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: '维护台次',
                    dataIndex: 'alarm_count',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: '离线台次',
                    dataIndex: 'inter_count',
                    sort: 'true',
                    align: 'right'
                },
                {
                    title: '故障损失电量(' + res.body.units.fail_we + ')',
                    dataIndex: 'fail_we',
                    sort: 'true',
                    align: 'right'
                },
                {
                    title: '组串电流离散率',
                    dataIndex: 'c_dr_avg',
                    sort: 'true',
                    align: 'right',
                }
            ];
        };

        //电站月-设备-曲线
        $scope.query_station_month_dev_detail_devline_his.getDataCallback = (success, res) => {
            $scope.equipmentDetailLoading = false;
            if (!success) return;
            diffSelectOptions(res.body.units);
            $scope.select1 = $scope.selectOptions[$scope.select1 || '__'] ? $scope.select1 : 'dust_we';
            $scope.select2 = $scope.selectOptions[$scope.select2 || '__'] ? $scope.select2 : 'fail_count';
            $scope.xdata = res.body.data.eq_name;
            $scope.ydatas = [[res.body.data[$scope.select1]], [res.body.data[$scope.select2]]];
        }

        //电站年-时间-列表
        $scope.query_station_year_dev_detail_timelist_his.getDataCallback = (success, res) => {
            $scope.equipmentDetailLoading = false;
            if (!success) return;
            $scope.dataSource = res.body.data;
            $scope.column = [
                {
                    title: '时间',
                    dataIndex: 'dtime',
                    align: 'center',
                },
                {
                    title: '故障台次',
                    dataIndex: 'fail_count',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: '告警台次',
                    dataIndex: 'alarm_count',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: '离线台次',
                    dataIndex: 'inter_count',
                    sort: 'true',
                    align: 'right'
                },
                {
                    title: '故障损失电量(' + res.body.units.dust_we + ')',
                    dataIndex: 'dust_we',
                    sort: 'true',
                    align: 'right'
                },
                {
                    title: 'mttr',
                    width: '60px',
                    dataIndex: 'mttr',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: 'mtbf',
                    width: '60px',
                    dataIndex: 'mtbf',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: 'pba',
                    width: '60px',
                    dataIndex: 'pba',
                    sort: 'true',
                    align: 'right'
                },
                {
                    title: 'pr',
                    width: '60px',
                    dataIndex: 'pr',
                    sort: 'true',
                    align: 'right'
                }
            ];
        };

        //电站年-时间-曲线
        $scope.query_station_year_dev_detail_timeline_his.getDataCallback = (success, res) => {
            $scope.equipmentDetailLoading = false;
            if (!success) return;
            diffSelectOptions(res.body.units);
            $scope.select1 = $scope.selectOptions[$scope.select1 || '__'] ? $scope.select1 : 'dust_we';
            $scope.select2 = $scope.selectOptions[$scope.select2 || '__'] ? $scope.select2 : 'fail_count';
            $scope.xdata = res.body.data.dtime;
            $scope.ydatas = [[res.body.data[$scope.select1]], [res.body.data[$scope.select2]]];
        }

        //电站年-设备-列表
        $scope.query_station_year_dev_detail_devlist_his.getDataCallback = (success, res) => {
            $scope.equipmentDetailLoading = false;
            if (!success) return;
            $scope.dataSource = res.body.data;
            $scope.column = [
                {
                    title: '设备名称',
                    width: '25%',
                    dataIndex: 'eq_name',
                    align: 'left',
                },
                // {
                //     title: '总台数',
                //     dataIndex: 'eqcount',
                //     sort: 'true',
                //     align: 'right'
                // },
                {
                    title: '故障台次',
                    dataIndex: 'fail_count',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: '维护台次',
                    dataIndex: 'alarm_count',
                    sort: 'true',
                    align: 'right',
                },
                {
                    title: '离线台次',
                    dataIndex: 'inter_count',
                    sort: 'true',
                    align: 'right'
                },
                {
                    title: '故障损失电量(' + res.body.units.fail_we + ')',
                    dataIndex: 'fail_we',
                    sort: 'true',
                    align: 'right'
                },
                {
                    title: '组串电流离散率',
                    dataIndex: 'c_dr_avg',
                    sort: 'true',
                    align: 'right',
                }
            ];
        };

        //电站年-设备-曲线
        $scope.query_station_year_dev_detail_devline_his.getDataCallback = (success, res) => {
            $scope.equipmentDetailLoading = false;
            if (!success) return;
            diffSelectOptions(res.body.units);
            $scope.select1 = $scope.selectOptions[$scope.select1 || '__'] ? $scope.select1 : 'dust_we';
            $scope.select2 = $scope.selectOptions[$scope.select2 || '__'] ? $scope.select2 : 'fail_count';
            $scope.xdata = res.body.data.eq_name;
            $scope.ydatas = [[res.body.data[$scope.select1]], [res.body.data[$scope.select2]]];
        }

        // 计算 图表 显示对应 轴
        function diffChartLineData() {
            if (!$scope.initComplete) return;
            const { currentClass, selectOptions, select1, select2 } = $scope;
            if (currentClass === 'CompanyDayAgo') {
                $scope.xdata = $scope.query_company_day_dev_detail_stationline_his.res.body.data.st_name;
                $scope.ydatas = [[$scope.query_company_day_dev_detail_stationline_his.res.body.data[select1]], [$scope.query_company_day_dev_detail_stationline_his.res.body.data[select2]]]
            } else if (currentClass === 'CompanyMonth') {
                if ($scope.tabIndex === 0) {
                    $scope.xdata = $scope.query_company_month_dev_detail_timeline_his.res.body.data.dtime;
                    $scope.ydatas = [[$scope.query_company_month_dev_detail_timeline_his.res.body.data[select1]]]
                } else if ($scope.tabIndex === 1) {
                    $scope.xdata = $scope.query_company_month_dev_detail_stationline_his.res.body.data.st_name;
                    $scope.ydatas = [[$scope.query_company_month_dev_detail_stationline_his.res.body.data[select1]], [$scope.query_company_month_dev_detail_stationline_his.res.body.data[select2]]]
                }
            } else if (currentClass === 'CompanyYear') {
                if ($scope.tabIndex === 0) {
                    $scope.xdata = $scope.query_company_year_dev_detail_timeline_his.res.body.data.dtime;
                    $scope.ydatas = [[$scope.query_company_year_dev_detail_timeline_his.res.body.data[select1]]]
                } else if ($scope.tabIndex === 1) {
                    $scope.xdata = $scope.query_company_year_dev_detail_stationline_his.res.body.data.st_name;
                    $scope.ydatas = [[$scope.query_company_year_dev_detail_stationline_his.res.body.data[select1]], [$scope.query_company_year_dev_detail_stationline_his.res.body.data[select2]]]
                }
            } else if (currentClass === 'StationMonth') {
                if ($scope.tabIndex === 0) {
                    $scope.xdata = $scope.query_station_month_dev_detail_timeline_his.res.body.data.dtime;
                    $scope.ydatas = [[$scope.query_station_month_dev_detail_timeline_his.res.body.data[select1]], [$scope.query_station_month_dev_detail_timeline_his.res.body.data[select2]]]
                } else if ($scope.tabIndex === 1) {
                    $scope.xdata = $scope.query_station_month_dev_detail_devline_his.res.body.data.eq_name;
                    $scope.ydatas = [[$scope.query_station_month_dev_detail_devline_his.res.body.data[select1]], [$scope.query_station_month_dev_detail_devline_his.res.body.data[select2]]]
                }
            } else if (currentClass === 'StationYear') {
                if ($scope.tabIndex === 0) {
                    $scope.xdata = $scope.query_station_year_dev_detail_timeline_his.res.body.data.dtime;
                    $scope.ydatas = [[$scope.query_station_year_dev_detail_timeline_his.res.body.data[select1]], [$scope.query_station_year_dev_detail_timeline_his.res.body.data[select2]]]
                } else if ($scope.tabIndex === 1) {
                    $scope.xdata = $scope.query_station_year_dev_detail_devline_his.res.body.data.eq_name;
                    $scope.ydatas = [[$scope.query_station_year_dev_detail_devline_his.res.body.data[select1]], [$scope.query_station_year_dev_detail_devline_his.res.body.data[select2]]]
                }
            }
        }

        // 轴线切换  可选项  判断
        function diffSelectOptions(units) {
            if ($scope.currentClass === 'CompanyDayAgo') {
                $scope.selectOptions = {
                    eqcount: '总台数',
                    fail_count: '故障台次',
                    alarm_count: '维护台次',
                    inter_count: '离线台次',
                    fail_we: '故障损失电量' + units.fail_we,
                    mttr: 'mttr',
                    mtbf: 'mtbf',
                    pba: 'pba',
                    pr: 'pr'
                }
            } else if ($scope.currentClass === 'CompanyMonth' || $scope.currentClass === 'CompanyYear') {
                if ($scope.tabIndex === 0) {
                    $scope.selectOptions = {
                        fail_count: '故障台次',
                        alarm_count: '维护台次',
                        inter_count: '离线台次'
                    }
                } else if ($scope.tabIndex === 1) {
                    $scope.selectOptions = {
                        eqcount: '总台数',
                        fail_count: '故障台次',
                        alarm_count: '维护台次',
                        inter_count: '离线台次',
                        fail_we: '故障损失电量' + units.fail_we,
                        mttr: 'mttr',
                        mtbf: 'mtbf',
                        pba: 'pba',
                        pr: 'pr'
                    }
                }
            } else if ($scope.currentClass === 'StationMonth' || $scope.currentClass === 'StationYear') {
                if ($scope.tabIndex === 0) {
                    $scope.selectOptions = {
                        fail_count: '故障台次',
                        alarm_count: '告警台次',
                        inter_count: '离线台次',
                        dust_we: '故障损失电量' + units.dust_we,
                        mttr: 'mttr',
                        mtbf: 'mtbf',
                        pba: 'pba',
                        pr: 'pr',
                    }
                } else if ($scope.tabIndex === 1) {
                    $scope.selectOptions = {
                        eqcount: '总台数',
                        fail_count: '故障台次',
                        alarm_count: '维护台次',
                        inter_count: '离线台次',
                        dust_we: '故障损失电量' + units.dust_we,
                        title: '功率离散率'
                    }
                }
            }
        }

        // 定时器  定时刷新接口
        const timer = $interval(() => {
            if (($scope.currentClass === 'StationDayToday' || $scope.currentClass === 'CompanyDayToday')) diffGetData();
        }, 10000);
        $scope.$on('$destroy', () => $interval.cancel(timer));

    });