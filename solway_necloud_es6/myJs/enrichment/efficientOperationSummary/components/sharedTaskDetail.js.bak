ajaxData({
    getLoginUserInfo: {
        name: 'loginUserInfo',
        data: {},
        later: true
    },
    shareTaskDetailList: {
        name: 'GETShareTaskDetailList',
        data: {},
        later: true,
        onlyLatest: true
    },
}, {
        __serviceName__: 'sharedTaskDetailService'
    })('sharedTaskDetailCtrl', ['$scope', 'sharedTaskDetailService'], ($scope, myAjaxData) => {

        //接收
        $scope.$on('chatPanelObj', (e, obj) => {
            $scope.shareList = [];
            $scope.shareListResult = true;
            $scope.noShareList = false;

            $scope.id = obj.id;
            $scope.distMan = obj.distMan;
            getShareList();
            getUserID();
        });


        $scope.$on('chatPanelObjTaskId', (e, obj) => {
            $scope.shareList = [];
            $scope.shareListResult = true;
            $scope.noShareList = false;

            $scope.taskId = obj.taskId;
            $scope.distMan = obj.distMan;
            getShareListTaskId();
            getUserID();
        });

        //获取当前用户ID
        const getUserID = () =>{
            $scope.getLoginUserInfo.getData({
            }).then(res => {
                $scope.userId = res.userId;
            });
        } 

        //列表接口
        const getShareList = () => {
            $scope.shareTaskDetailList.getData(
                { id: $scope.id }
            ).then(res => {
                $scope.shareListResult = false;
                $scope.shareList = res.body;
                if ($scope.shareList.length == 0){
                    $scope.noShareList = true;
                }
            });
        }

        const getShareListTaskId = () => {
            
            $scope.shareTaskDetailList.getData(
                { taskId: $scope.taskId }
            ).then(res => {
                $scope.shareListResult = false;
                $scope.shareList = res.body;
                if ($scope.shareList.length == 0) {
                    $scope.noShareList = true;
                }
            });
        }

        //详情
        $scope.showDetail = id =>{
            $scope.shareTaskDetailShow = true;
            $scope.$broadcast('shareTaskDetailBro',id);
        }

        $scope.getSendList = arr =>{
            return arr.replace(/,/g, "   ")
        }

        //审核
        $scope.examine = () => {

        }

        //发红包
        $scope.handOutMoney = () => {

        }


        $scope.$on('$destroy', () => {
            // window.removeEventListener('resize', resizeHeight);
        });

    });