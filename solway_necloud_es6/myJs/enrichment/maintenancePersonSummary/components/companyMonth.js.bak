ajaxData({
    //公司----月

    //时间
    analysis_company_operation_time_month_list: {
        name: 'GETanalysis_company_operation_time_month_list',
        data: {},
        later: true,
        onlyLatest: true
    },
    //电站
    analysis_company_operation_station_month_list: {
        name: 'GETanalysis_company_operation_station_month_list',
        data: {},
        later: true,
        onlyLatest: true
    },
    //专业人员
    analysis_company_operation_person_month_list: {
        name: 'GETanalysis_company_operation_person_month_list',
        data: {},
        later: true,
        onlyLatest: true
    },
    //共享人员

}, {
    __serviceName__: 'maintenancePersonCompanyMonth',
})('maintenancePersonCompanyMonthCtrl', ['$scope', 'maintenancePersonCompanyMonth', 'actionRecord'], ($scope, myAjaxData, historicalRecord) => {
    /// 初始化 scope
    $scope.initChildScope($scope, myAjaxData);

    // 主页面初始化完成 回调
    $scope.mainPageInitComplete = async () => {
        let { tabIndex = 0 } = historicalRecord.get().themeMaintenanceCompanyMonth || {};
        const { dateType, dateTime } = historicalRecord.get();
        $scope.dateType = dateType;
        $scope.dateTime = dateTime;
        // await $scope.dateUpdated();
        $scope.changeTab(tabIndex);
        $('.ng-clock').removeClass('ng-clock');
        $scope.initComplete = true;
        await myAjaxData.timeout(0);
        await $scope.diffGetData(true);
        $scope.$apply();
    };


    // 切换电站 回调
    $scope.switchPowerCallback = () => {
        $scope.diffGetData();
    };

    // 日期改变
    $scope.dateUpdated = async () => {
        await myAjaxData.timeout(0);
        $scope.diffGetData(true);
    };


    // tab 切换
    $scope.changeTab = tabIndex => {
        $scope.tabIndex = tabIndex;
        historicalRecord.set({
            themeMaintenanceCompanyMonth: {
                ...historicalRecord.get().themeMaintenanceCompanyMonth || {},
                tabIndex
            }
        });
        $scope.diffGetData();
    };

    $scope.trClick = (item,index,e) =>{
        e.stopPropagation();
        if($scope.tabIndex == 2 || $scope.tabIndex == 3){
            $scope.$broadcast('paramsPeopleInfoProfessional',{'userId':item.userid});
            $scope.showPeopleInfoProfessional = true;
        }
    }

    $scope.$watch('showPeopleInfoProfessional',(n,o)=>{
        if(!n){
            $scope.$broadcast('clearDate');
        }
    });
    // 判断 调用  对应 接口
    $scope.diffGetData = async()=>{
        if (!$scope.initComplete ) return;
        $scope.companyMonthLoading = true;
        await myAjaxData.timeout(0);
        // setDataNull(getInfo);

        const {dateTime, tabIndex ,dateType, dataType} = $scope;
        if(dateType !== 1) return;
        if(!dataType) return; //公司

        switch (tabIndex) {
            case 0: //时间
                $scope.analysis_company_operation_time_month_list.getData({
                    queryCode: 'analysis_company_operation_time_month_list',
                    queryType: 1,
                    date: dateTime.showDate
                });
                break;
            case 1: //电站
                $scope.analysis_company_operation_station_month_list.getData({
                    queryCode: 'analysis_company_operation_station_month_list',
                    queryType: 1,
                    date: dateTime.showDate
                });
                break;
            case 2: //专业人员
                $scope.analysis_company_operation_person_month_list.getData({
                    queryCode: 'analysis_company_operation_person_month_list',
                    queryType: 1,
                    date: dateTime.showDate,
                    pageIndex: 0,
                    pageSize: 20
                });
                break;
            case 3: //共享人员
                test();
                break;
            default:
                break;
        }
        
    }

    // 时间列表
    $scope.analysis_company_operation_time_month_list.getDataCallback = (success, res) => {
        $scope.companyMonthLoading = false;

        if (!success) return;
        $scope.listSource = res.body.data;

        $scope.column = [
            {
                title: '时间',
                width: '25%',
                dataIndex: 'dtime',
                align: 'left',
                // render(text, record, index) {
                //     return `<span class="alert-name" id="${record.id}">${text}</span>`
                // }
            },
            {
                title: '检修台次',
                dataIndex: 'repair_count',
                align: 'right',
            },
            {
                title: '检修台数',
                dataIndex: 'repair_number',
                align: 'right',
            },
            {
                title: '响应时间'+ '(' + res.body.units.res_hours_avg + ')',
                dataIndex: 'res_hours_avg',
                sort: 'true',
                align: 'right',
                render(text, record, index) {
                    return `<span>${text===null?0:text}</span>`
                }
            },
            {
                title: '检修时间'+ '(' + res.body.units.repair_hours_avg + ')',
                dataIndex: 'repair_hours_avg',
                align: 'right',
                render(text, record, index) {
                    return `<span>${text===null?0:text}</span>`
                }
            },
            {
                title: '检修成功率'+ '(' + res.body.units.repair_finish_r + ')',
                dataIndex: 'repair_finish_r',
                sort: 'true',
                align: 'right'
            }
        ];
        
        // $scope.selectedBrands = [],$scope.selectedFaults = [];
        // $scope.$watch("selectedBrands", function(n, o){
        //     // console.log(n)
        // })
        // $scope.$watch("selectedFaults", function(n, o){
        //     // console.log(n)
        // })

        // $(".maintenanceStationMonth").on('click','.alert-name',function(){
        //     let a = $(this).attr('id')
        // })
        // 
        // 
    };

    // 电站列表
    $scope.analysis_company_operation_station_month_list.getDataCallback = (success, res) => {
        $scope.companyMonthLoading = false;

        if (!success) return;
        $scope.listSource = res.body.data;
        
        $scope.column = [
            {
                title: '电站',
                width: '25%',
                dataIndex: 'st_name',
                align: 'left',
                // render(text, record, index) {
                //     return `<span class="alert-name" id="${record.id}">${text}</span>`
                // }
            },
            {
                title: '检修台次',
                dataIndex: 'repair_count',
                align: 'right',
            },
            {
                title: '检修台数',
                dataIndex: 'repair_number',
                align: 'right',
            },
            {
                title: '响应时间'+ '(' + res.body.units.res_hours_avg + ')',
                dataIndex: 'res_hours_avg',
                sort: 'true',
                align: 'right',
                render(text, record, index) {
                    return `<span>${text===null?0:text}</span>`
                }
            },
            {
                title: '检修时间'+ '(' + res.body.units.repair_hours_avg + ')',
                dataIndex: 'repair_hours_avg',
                align: 'right',
                render(text, record, index) {
                    return `<span>${text===null?0:text}</span>`
                }
            },
            {
                title: '检修成功率'+ '(' + res.body.units.repair_finish_r + ')',
                dataIndex: 'repair_finish_r',
                sort: 'true',
                align: 'right'
            }
        ];
        
        // $scope.selectedBrands = [],$scope.selectedFaults = [];
        // $scope.$watch("selectedBrands", function(n, o){
        //     // console.log(n)
        // })
        // $scope.$watch("selectedFaults", function(n, o){
        //     // console.log(n)
        // })

        // $(".maintenanceStationMonth").on('click','.alert-name',function(){
        //     let a = $(this).attr('id')
        // })
        // 
        // 
    };

    // 专业人员列表
    $scope.analysis_company_operation_person_month_list.getDataCallback = (success, res) => {
        $scope.companyMonthLoading = false;

        if (!success) return;
        $scope.listSource = res.body.data.data;
        $scope.column = [
            {
                title: '姓名',
                width: '25%',
                dataIndex: 'user_name',
                align: 'left',
                // render(text, record, index) {
                //     return `<span class="alert-name" id="${record.id}">${text}</span>`
                // }
            },
            {
                title: '检修台次',
                dataIndex: 'repair_count',
                align: 'right',
            },
            {
                title: '检修台数',
                dataIndex: 'repair_number',
                align: 'right',
            },
            {
                title: '响应时间'+ '(' + res.body.units.res_hours_avg + ')',
                dataIndex: 'res_hours_avg',
                sort: 'true',
                align: 'right',
                render(text, record, index) {
                    return `<span>${text===null?0:text}</span>`
                }
            },
            {
                title: '检修时间'+ '(' + res.body.units.repair_hours_avg + ')',
                dataIndex: 'repair_hours_avg',
                align: 'right',
                render(text, record, index) {
                    return `<span>${text===null?0:text}</span>`
                }
            },
            {
                title: '检修成功率'+ '(' + res.body.units.repair_finish_r + ')',
                dataIndex: 'repair_finish_r',
                sort: 'true',
                align: 'right'
            }
        ];
        
        // $scope.selectedBrands = [],$scope.selectedFaults = [];
        // $scope.$watch("selectedBrands", function(n, o){
        //     // console.log(n)
        // })
        // $scope.$watch("selectedFaults", function(n, o){
        //     // console.log(n)
        // })

        // $(".maintenanceStationMonth").on('click','.alert-name',function(){
        //     let a = $(this).attr('id')
        // })
        // 
        // 
    };

    //共享人员列表
    function test(){
        // if (!success) return;
        $scope.companyMonthLoading = false;

        $scope.listSource = [];
        $scope.pageData = {};
        $scope.column = [];
        $scope.$apply();
    }




    // 销毁 事件
    $scope.$on('$destroy', () => {
    });
});