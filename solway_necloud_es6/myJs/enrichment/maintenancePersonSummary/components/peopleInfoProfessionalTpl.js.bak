ajaxData({
    //人员注册信息
    regInfo:{
        name: 'GETregInfo',
        data: {},
        later: true,
        onlyLatest: true
    },
    //故障  品牌 型号 维修记录
    
     
    //电站-专业运维人员-故障分析-月-曲线
    analysis_station_operation_person_ft_month_line:{
        name: 'GETanalysis_station_operation_person_ft_month_line',
        data: {},
        later: true,
        onlyLatest: true
    },
    //电站-专业运维人员-品牌分析-月-曲线
    analysis_station_operation_person_manuf_month_line:{
        name: 'GETanalysis_station_operation_person_manuf_month_line',
        data: {},
        later: true,
        onlyLatest: true
    },
    //电站-专业运维人员-型号分析-月-曲线
    analysis_station_operation_person_product_month_line:{
        name: 'GETanalysis_station_operation_person_product_month_line',
        data: {},
        later: true,
        onlyLatest: true
    },
    //电站-专业运维人员-维修记录-月-列表
    analysis_station_operation_person_oprecord_month_list:{
        name: 'GETanalysis_station_operation_person_oprecord_month_list',
        data: {},
        later: true,
        onlyLatest: true
    },

    // 电站-专业运维人员-故障分析-年-曲线
    analysis_station_operation_person_ft_year_line:{
        name: 'GETanalysis_station_operation_person_ft_year_line',
        data: {},
        later: true,
        onlyLatest: true
    },
    // 电站-专业运维人员-品牌分析-年-曲线
    analysis_station_operation_person_manuf_year_line:{
        name: 'GETanalysis_station_operation_person_manuf_year_line',
        data: {},
        later: true,
        onlyLatest: true
    },
    // 电站-专业运维人员-型号分析-年-曲线
    analysis_station_operation_person_product_year_line:{
        name: 'GETanalysis_station_operation_person_product_year_line',
        data: {},
        later: true,
        onlyLatest: true
    },
    // 电站-专业运维人员-维修记录-年-列表
    analysis_station_operation_person_oprecord_year_list:{
        name: 'GETanalysis_station_operation_person_oprecord_year_list',
        data: {},
        later: true,
        onlyLatest: true
    },

    // 电站-专业运维人员-故障分析-累计-曲线 
    analysis_station_operation_person_ft_accum_line:{
        name: 'GETanalysis_station_operation_person_ft_accum_line',
        data: {},
        later: true,
        onlyLatest: true
    },
    // 电站-专业运维人员-品牌分析-累计-曲线
    analysis_station_operation_person_manuf_accum_line:{
        name: 'GETanalysis_station_operation_person_manuf_accum_line',
        data: {},
        later: true,
        onlyLatest: true
    },
    // 电站-专业运维人员-型号分析-累计-曲线
    analysis_station_operation_person_product_accum_line:{
        name: 'GETanalysis_station_operation_person_product_accum_line',
        data: {},
        later: true,
        onlyLatest: true
    },
    // 电站-专业运维人员-维修记录-累计-列表
    analysis_station_operation_person_oprecord_accum_list:{
        name: 'GETanalysis_station_operation_person_oprecord_accum_list',
        data: {},
        later: true,
        onlyLatest: true
    },
    
    //  公司-专业运维人员-故障分析-月-曲线
    analysis_company_operation_person_ft_month_line:{
        name: 'GETanalysis_company_operation_person_ft_month_line',
        data: {},
        later: true,
        onlyLatest: true
    },
    //  公司-专业运维人员-品牌分析-月-曲线
    analysis_company_operation_person_manuf_month_line:{
        name: 'GETanalysis_company_operation_person_manuf_month_line',
        data: {},
        later: true,
        onlyLatest: true
    },
    //  公司-专业运维人员-型号分析-月-曲线
    analysis_company_operation_person_product_month_line:{
        name: 'GETanalysis_company_operation_person_product_month_line',
        data: {},
        later: true,
        onlyLatest: true
    },
    //  公司-专业运维人员-维修记录-月-列表
    analysis_company_operation_person_oprecord_month_list:{
        name: 'GETanalysis_company_operation_person_oprecord_month_list',
        data: {},
        later: true,
        onlyLatest: true
    },
    
    // 公司-专业运维人员-故障分析-年-曲线
    analysis_company_operation_person_ft_year_line:{
        name: 'GETanalysis_company_operation_person_ft_year_line',
        data: {},
        later: true,
        onlyLatest: true
    },
    // 公司-专业运维人员-品牌分析-年-曲线
    analysis_company_operation_person_manuf_year_line:{
        name: 'GETanalysis_company_operation_person_manuf_year_line',
        data: {},
        later: true,
        onlyLatest: true
    },
    // 公司-专业运维人员-型号分析-年-曲线 
    analysis_company_operation_person_product_year_line:{
        name: 'GETanalysis_company_operation_person_product_year_line',
        data: {},
        later: true,
        onlyLatest: true
    },
    // 公司-专业运维人员-维修记录-年-列表
    analysis_company_operation_person_oprecord_year_list:{
        name: 'GETanalysis_company_operation_person_oprecord_year_list',
        data: {},
        later: true,
        onlyLatest: true
    },
    
    // 公司-专业运维人员-故障分析-累计-曲线
    analysis_company_operation_person_ft_accum_line:{
        name: 'GETanalysis_company_operation_person_ft_accum_line',
        data: {},
        later: true,
        onlyLatest: true
    },
    // 公司-专业运维人员-品牌分析-累计-曲线
    analysis_company_operation_person_manuf_accum_line:{
        name: 'GETanalysis_company_operation_person_manuf_accum_line',
        data: {},
        later: true,
        onlyLatest: true
    },
    // 公司-专业运维人员-型号分析-累计-曲线
    analysis_company_operation_person_product_accum_line:{
        name: 'GETanalysis_company_operation_person_product_accum_line',
        data: {},
        later: true,
        onlyLatest: true
    },
    // 公司-专业运维人员-维修记录-累计-列表
    analysis_company_operation_person_oprecord_accum_list:{
        name: 'GETanalysis_company_operation_person_oprecord_accum_list',
        data: {},
        later: true,
        onlyLatest: true
    }
}, {
        __serviceName__: 'peopleInfoTplProfessionalService'
    })('peopleInfoProfessionalCtrl', ['$scope', 'peopleInfoTplProfessionalService'], ($scope, myAjaxData) => {

        

        //接收参数，调接口
        $scope.$on('paramsPeopleInfoProfessional',(e,v)=>{
            $scope.beginTime = new Date()
            $scope.beginTime.showDate = ''
            $scope.endTime = new Date()
            $scope.endTime.showDate = ''

            $scope.userId = v.userId;
            $scope.diffGetData();
        })

        $scope.$on('clearDate',()=>{
            $scope.beginTime = null
            $scope.endTime = null
        })
        
        const colorMap = ['rgb(124,192,246)','rgb(250,144,141)','rgb(249,173,129)']

        let faultPieEchart = echarts.init(document.getElementById('faultPieEchart'))
        let brandPieEchart = echarts.init(document.getElementById('brandPieEchart'))
        let modelPieEchart = echarts.init(document.getElementById('modelPieEchart'))

        const initFaultPieEchart = (data) => {
            const ft_name = data.ft_name;
            const repair_number = data.repair_number;
            const seriesData = []
            for(var i=0;i<repair_number.length;i++){
                seriesData.push({
                    value:repair_number[i],
                    name:ft_name[i],
                    itemStyle: {
                        normal: {
                            color: colorMap[i]
                        }
                    }
                });
            }
            const option = {
                title : {
                    text: '故障',
                    textStyle:{
                        color:'white',
                        fontSize:'16'
                    },
                    y:'center',
                    x:'left'
                },
                tooltip: {
                    trigger: 'item',
                    confine:true
                },
                // legend: {
                //     data:ft_name,
                //     textStyle:{
                //         color:'white',
                //         fontSize:'12'
                //     },
                //     orient: 'vertical',
                //     right: 10,
                //     top: 30,
                // },
                series: [
                    {
                        type: 'pie',
                        radius: ['25', '55px'],
                        center: ['60%', '50%'],
                        label: {
                            normal: {
                                show: false,
                                position: 'inside'
                            },
                            emphasis: {
                                show: false
                            }
                        },
                        lableLine: {
                            normal: {
                                show: false
                            },
                            emphasis: {
                                show: false
                            }
                        },
                        data: seriesData
                    }
                ]
            };
            faultPieEchart.setOption(option)
            faultPieEchart.resize();
        }
        const initBrandPieEchart = (data) => {
            const manuf_name = data.manuf_name;
            const repair_number = data.repair_number;
            const seriesData = []
            for(var i=0;i<repair_number.length;i++){
                seriesData.push({
                    value:repair_number[i],
                    name:manuf_name[i],
                    itemStyle: {
                        normal: {
                            color: colorMap[i]
                        }
                    }
                });
            }
            const option = {
                title : {
                    text: '品牌',
                    textStyle:{
                        color:'white',
                        fontSize:'16'
                    },
                    y:'center',
                    x:'left'
                },
                tooltip: {
                    trigger: 'item',
                    confine:true
                },
                // legend: {
                //     data:manuf_name,
                //     textStyle:{
                //         color:'white',
                //         fontSize:'12'
                //     },
                //     orient: 'vertical',
                //     right: 10,
                //     top: 30,
                // },
                series: [
                    {
                        type: 'pie',
                        radius: ['25', '55px'],
                        center: ['60%', '50%'],
                        // animation:false,
                        label: {
                            normal: {
                                show: false,
                                position: 'inside'
                            },
                            emphasis: {
                                show: false
                            }
                        },
                        lableLine: {
                            normal: {
                                show: false
                            },
                            emphasis: {
                                show: false
                            }
                        },
                        itemStyle:{
                            normal:{
                                
                            }
                        },
                        data:seriesData
                    }
                ]
            };
            brandPieEchart.setOption(option)
            brandPieEchart.resize();
        }

        const initModelPieEchart = (data) => {
            const product_name = data.product_name;
            const repair_number = data.repair_number;
            const seriesData = []
            for(var i=0;i<repair_number.length;i++){
                seriesData.push({
                    value:repair_number[i],
                    name:product_name[i],
                    itemStyle: {
                        normal: {
                            color: colorMap[i]
                        }
                    }
                });
            }
            const option = {
                title : {
                    text: '型号',
                    textStyle:{
                        color:'white',
                        fontSize:'16'
                    },
                    y:'center',
                    x:'left'
                },
                tooltip: {
                    trigger: 'item',
                    confine:true
                },
                // legend: {
                //     data:product_name,
                //     textStyle:{
                //         color:'white',
                //         fontSize:'12'
                //     },
                //     orient: 'vertical',
                //     right: 10,
                //     top: 30,
                // },
                series: [
                    {
                        type: 'pie',
                        radius: ['25', '55px'],
                        center: ['60%', '50%'],
                        label: {
                            normal: {
                                show: false,
                                position: 'inside'
                            },
                            emphasis: {
                                show: false
                            }
                        },
                        lableLine: {
                            normal: {
                                show: false
                            },
                            emphasis: {
                                show: false
                            }
                        },
                        itemStyle:{
                            normal:{
                                
                            }
                        },
                        data: seriesData
                    }
                ]
            };
            modelPieEchart.setOption(option)
            modelPieEchart.resize();
        }

        

        $scope.diffGetData = async()=>{
            // if (!$scope.initComplete) return;
            // await myAjaxData.timeout(0);
            
            const {dataType,dateType,dateTime,userId} = $scope; //dataType,0:电站1,2:公司集团  ; dateType,1:月，2：年，3：累计

            $scope.startEventTime = $scope.beginTime.showDate;
            $scope.endEventTime = $scope.endTime.showDate;

            $scope.regInfo.getData({ //故障
                userId:userId
            });
            if(dataType){//集团
                switch (dateType) {
                    case 1: 
                        //月
                        $scope.analysis_company_operation_person_ft_month_line.getData({ //故障
                            queryCode: 'analysis_company_operation_person_ft_month_line',
                            queryType: 1,
                            userid:userId,
                            date: dateTime.showDate
                        });
                        $scope.analysis_company_operation_person_manuf_month_line.getData({ //品牌
                            queryCode: 'analysis_company_operation_person_manuf_month_line',
                            queryType: 1,
                            userid:userId,
                            date: dateTime.showDate
                        });
                        $scope.analysis_company_operation_person_product_month_line.getData({ //型号
                            queryCode: 'analysis_company_operation_person_product_month_line',
                            queryType: 1,
                            userid:userId,
                            date: dateTime.showDate
                        });
                        $scope.analysis_company_operation_person_oprecord_month_list.getData({ //维修
                            queryCode: 'analysis_company_operation_person_oprecord_month_list',
                            queryType: 1,
                            userid:userId,
                            date: dateTime.showDate,
                            start_date:$scope.startEventTime,
                            end_date:$scope.endEventTime
                        });
                        break;
                    case 2: 
                        //年
                        $scope.analysis_company_operation_person_ft_year_line.getData({ //故障
                            queryCode: 'analysis_company_operation_person_ft_year_line',
                            queryType: 1,
                            userid:userId,
                            date: dateTime.showDate
                        });
                        $scope.analysis_company_operation_person_manuf_year_line.getData({ //品牌
                            queryCode: 'analysis_company_operation_person_manuf_year_line',
                            queryType: 1,
                            userid:userId,
                            date: dateTime.showDate
                        });
                        $scope.analysis_company_operation_person_product_year_line.getData({ //型号
                            queryCode: 'analysis_company_operation_person_product_year_line',
                            queryType: 1,
                            userid:userId,
                            date: dateTime.showDate
                        });
                        $scope.analysis_company_operation_person_oprecord_year_list.getData({ //维修
                            queryCode: 'analysis_company_operation_person_oprecord_year_list',
                            queryType: 1,
                            userid:userId,
                            date: dateTime.showDate,
                            start_date:$scope.startEventTime,
                            end_date:$scope.endEventTime
                        });
                        break;
                    case 3: 
                        //累计
                        $scope.analysis_company_operation_person_ft_accum_line.getData({ //故障
                            queryCode: 'analysis_company_operation_person_ft_accum_line',
                            queryType: 1,
                            userid:userId,
                            date: dateTime.showDate
                        });
                        $scope.analysis_company_operation_person_manuf_accum_line.getData({ //品牌
                            queryCode: 'analysis_company_operation_person_manuf_accum_line',
                            queryType: 1,
                            userid:userId,
                            date: dateTime.showDate
                        });
                        $scope.analysis_company_operation_person_product_accum_line.getData({ //型号
                            queryCode: 'analysis_company_operation_person_product_accum_line',
                            queryType: 1,
                            userid:userId,
                            date: dateTime.showDate
                        });
                        $scope.analysis_company_operation_person_oprecord_accum_list.getData({ //维修
                            queryCode: 'analysis_company_operation_person_oprecord_accum_list',
                            queryType: 1,
                            userid:userId,
                            date: dateTime.showDate,
                            start_date:$scope.startEventTime,
                            end_date:$scope.endEventTime
                        });
                        break;
                    default:
                        break;
                }
            }else{//电站
                
                switch (dateType) {
                    case 1: 
                        //月
                        $scope.analysis_station_operation_person_ft_month_line.getData({ //故障
                            queryCode: 'analysis_station_operation_person_ft_month_line',
                            queryType: 1,
                            userid:userId,
                            date: dateTime.showDate
                        });
                        $scope.analysis_station_operation_person_manuf_month_line.getData({ //品牌
                            queryCode: 'analysis_station_operation_person_manuf_month_line',
                            queryType: 1,
                            userid:userId,
                            date: dateTime.showDate
                        });
                        $scope.analysis_station_operation_person_product_month_line.getData({ //型号
                            queryCode: 'analysis_station_operation_person_product_month_line',
                            queryType: 1,
                            userid:userId,
                            date: dateTime.showDate
                        });
                        $scope.analysis_station_operation_person_oprecord_month_list.getData({ //维修
                            queryCode: 'analysis_station_operation_person_oprecord_month_list',
                            queryType: 1,
                            userid:userId,
                            date: dateTime.showDate,
                            start_date:$scope.startEventTime,
                            end_date:$scope.endEventTime
                        });
                        break;
                    case 2: 
                        //年
                        $scope.analysis_station_operation_person_ft_year_line.getData({ //故障
                            queryCode: 'analysis_station_operation_person_ft_year_line',
                            queryType: 1,
                            userid:userId,
                            date: dateTime.showDate
                        });
                        $scope.analysis_station_operation_person_manuf_year_line.getData({ //品牌
                            queryCode: 'analysis_station_operation_person_manuf_year_line',
                            queryType: 1,
                            userid:userId,
                            date: dateTime.showDate
                        });
                        $scope.analysis_station_operation_person_product_year_line.getData({ //型号
                            queryCode: 'analysis_station_operation_person_product_year_line',
                            queryType: 1,
                            userid:userId,
                            date: dateTime.showDate
                        });
                        $scope.analysis_station_operation_person_oprecord_year_list.getData({ //维修
                            queryCode: 'analysis_station_operation_person_oprecord_year_list',
                            queryType: 1,
                            userid:userId,
                            date: dateTime.showDate,
                            start_date:$scope.startEventTime,
                            end_date:$scope.endEventTime
                        });
                        break;
                    case 3: 
                        //累计
                        $scope.analysis_station_operation_person_ft_accum_line.getData({ //故障
                            queryCode: 'analysis_station_operation_person_ft_accum_line',
                            queryType: 1,
                            userid:userId,
                            date: dateTime.showDate
                        });
                        $scope.analysis_station_operation_person_manuf_accum_line.getData({ //品牌
                            queryCode: 'analysis_station_operation_person_manuf_accum_line',
                            queryType: 1,
                            userid:userId,
                            date: dateTime.showDate
                        });
                        $scope.analysis_station_operation_person_product_accum_line.getData({ //型号
                            queryCode: 'analysis_station_operation_person_product_accum_line',
                            queryType: 1,
                            userid:userId,
                            date: dateTime.showDate
                        });
                        $scope.analysis_station_operation_person_oprecord_accum_list.getData({ //维修
                            queryCode: 'analysis_station_operation_person_oprecord_accum_list',
                            queryType: 1,
                            userid:userId,
                            date: dateTime.showDate,
                            start_date:$scope.startEventTime,
                            end_date:$scope.endEventTime
                        });
                        break;
                    default:
                        break;
                }
            }
            
        }

        //人员注册信息
        $scope.regInfo.getDataCallback = (success, res) =>{
            if (!success) return;
            $scope.registInfo = res.body;
        }

        //公司-月
        $scope.analysis_company_operation_person_ft_month_line.getDataCallback = (success, res) => {
            if (!success) return;
            initFaultPieEchart(res.body.data);
        }
        $scope.analysis_company_operation_person_manuf_month_line.getDataCallback = (success, res) => {
            if (!success) return;
            initBrandPieEchart(res.body.data);
        }
        $scope.analysis_company_operation_person_product_month_line.getDataCallback = (success, res) => {
            if (!success) return;
            initModelPieEchart(res.body.data);
        }
        $scope.analysis_company_operation_person_oprecord_month_list.getDataCallback = (success, res) => {
            if (!success) return;
            $scope.datasource = res.body.data;
        }

        //公司-年
        $scope.analysis_company_operation_person_ft_year_line.getDataCallback = (success, res) => {
            if (!success) return;
            initFaultPieEchart(res.body.data);
        }
        $scope.analysis_company_operation_person_manuf_year_line.getDataCallback = (success, res) => {
            if (!success) return;
            initBrandPieEchart(res.body.data);
        }
        $scope.analysis_company_operation_person_product_year_line.getDataCallback = (success, res) => {
            if (!success) return;
            initModelPieEchart(res.body.data);
        }
        $scope.analysis_company_operation_person_oprecord_year_list.getDataCallback = (success, res) => {
            if (!success) return;
            $scope.datasource = res.body.data;
        }

        //公司-累计
        $scope.analysis_company_operation_person_ft_accum_line.getDataCallback = (success, res) => {
            if (!success) return;
            initFaultPieEchart(res.body.data);
        }
        $scope.analysis_company_operation_person_manuf_accum_line.getDataCallback = (success, res) => {
            if (!success) return;
            initBrandPieEchart(res.body.data);
        }
        $scope.analysis_company_operation_person_product_accum_line.getDataCallback = (success, res) => {
            if (!success) return;
            initModelPieEchart(res.body.data);
        }
        $scope.analysis_company_operation_person_oprecord_accum_list.getDataCallback = (success, res) => {
            if (!success) return;
            $scope.datasource = res.body.data;
        }

        //电站-月
        $scope.analysis_station_operation_person_ft_month_line.getDataCallback = (success, res) => {
            if (!success) return;
            initFaultPieEchart(res.body.data);
        }
        $scope.analysis_station_operation_person_manuf_month_line.getDataCallback = (success, res) => {
            if (!success) return;
            initBrandPieEchart(res.body.data);
        }
        $scope.analysis_station_operation_person_product_month_line.getDataCallback = (success, res) => {
            if (!success) return;
            initModelPieEchart(res.body.data);
        }
        $scope.analysis_station_operation_person_oprecord_month_list.getDataCallback = (success, res) => {
            if (!success) return;
            $scope.datasource = res.body.data;
            $scope.column = [
                {
                    title: '时间',
                    width: '25%',
                    dataIndex: 'event_time',
                    align: 'left',
                    // render(text, record, index) {
                    //     return `<span class="alert-name" id="${record.id}">${text}</span>`
                    // }
                },
                {
                    title: '电站名称',
                    dataIndex: 'st_name',
                    
                },
                {
                    title: '设备型号',
                    dataIndex: 'product_name',
                    
                },
                {
                    title: '设备名称',
                    dataIndex: 'eq_name',
                    align: 'right',
                },
                {
                    title: '设备故障',
                    dataIndex: 'ft_name',
                }
                
            ];
        }

        //电站-年
        $scope.analysis_station_operation_person_ft_year_line.getDataCallback = (success, res) => {
            if (!success) return;
            initFaultPieEchart(res.body.data);
        }
        $scope.analysis_station_operation_person_manuf_year_line.getDataCallback = (success, res) => {
            if (!success) return;
            initBrandPieEchart(res.body.data);
        }
        $scope.analysis_station_operation_person_product_year_line.getDataCallback = (success, res) => {
            if (!success) return;
            initModelPieEchart(res.body.data);
        }
        $scope.analysis_station_operation_person_oprecord_year_list.getDataCallback = (success, res) => {
            if (!success) return;
            $scope.datasource = res.body.data;
        }

        //电站-累计
        $scope.analysis_station_operation_person_ft_accum_line.getDataCallback = (success, res) => {
            if (!success) return;
            initFaultPieEchart(res.body.data);
        }
        $scope.analysis_station_operation_person_manuf_accum_line.getDataCallback = (success, res) => {
            if (!success) return;
            initBrandPieEchart(res.body.data);
        }
        $scope.analysis_station_operation_person_product_accum_line.getDataCallback = (success, res) => {
            if (!success) return;
            initModelPieEchart(res.body.data);
        }
        $scope.analysis_station_operation_person_oprecord_accum_list.getDataCallback = (success, res) => {
            if (!success) return;
            $scope.datasource = res.body.data;
        }

        
        $scope.column = [
            {
                title: '时间',
                width: '25%',
                dataIndex: 'event_time',
                align: 'left',
                // render(text, record, index) {
                //     return `<span class="alert-name" id="${record.id}">${text}</span>`
                // }
            },
            {
                title: '电站名称',
                dataIndex: 'st_name',
                
            },
            {
                title: '设备型号',
                dataIndex: 'product_name',
                
            },
            {
                title: '设备名称',
                dataIndex: 'eq_name',
                align: 'right',
            },
            {
                title: '设备故障',
                dataIndex: 'ft_name',
            }
            
        ];
    

        $scope.$on('$destroy', () => {
            $scope.beginTime = null
            $scope.endTime = null
            // window.removeEventListener('resize', resizeHeight);
        });

    });