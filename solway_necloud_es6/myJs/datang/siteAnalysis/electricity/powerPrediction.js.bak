ajaxData({
    list: {
        name: 'GETforecastPowerList',
        data: {
            dateStr: (new Date).Format('yyyy-MM-dd')
        },
        later: true,
        onlyLatest: true
    },
    line: {
        name: 'GETforecastPowerLine',
        data: {
            dateStr: (new Date).Format('yyyy-MM-dd')
        },
        later: true,
        onlyLatest: true
    },
}, {
    })('powerPredictionCtrl', ['$scope', 'myAjaxData', '$interval'], ($scope, myAjaxData, $interval) => {
        $scope.dateTime1 = new Date;
        $scope.dateTime2 = new Date;
        $scope.customLoading = true;

        $scope.allGetDataCallback = () => $scope.customLoading = false;

        $scope.updated = async () => {
            await myAjaxData.timeout(0);
            $scope.customLoading = true;
            $scope.list.getData({ dateStr: $scope.dateTime1.showDate });
            $scope.line.getData({ dateStr: $scope.dateTime1.showDate }).then(timer);
        };

        let handle = null;
        function timer(params) {
            if (handle) $interval.cancel(handle);
            handle = $interval(() => {
                $scope.line.getData({});
                if ((+$scope.dateTime1 + 1000 * 60 * 60 * 24 * 3) < +$scope.dateTime2) return;
                $scope.list.getData({});
            }, 10000);
        }

        $scope.$on('$destroy', () => $interval.cancel(handle));
    });